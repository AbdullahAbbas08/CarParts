<div class="model-type-dashboard">
  <!-- Background Overlay -->
  <div class="dashboard-background"></div>
  
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="container">
      <!-- Breadcrumb -->
      <nav class="breadcrumb-nav">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a routerLink="/dashboard">
              <i class="fas fa-home"></i>
              الرئيسية
            </a>
          </li>
          <li class="breadcrumb-separator">
            <i class="fas fa-chevron-left"></i>
          </li>
          <li class="breadcrumb-item">
            <a routerLink="/dashboard/lookup">
              <i class="fas fa-search"></i>
              البحث والتصنيفات
            </a>
          </li>
          <li class="breadcrumb-separator">
            <i class="fas fa-chevron-left"></i>
          </li>
          <li class="breadcrumb-item active">
            <i class="fas fa-car-side"></i>
            إدارة موديلات السيارات
          </li>
        </ol>
      </nav>

      <!-- Page Title -->
      <div class="page-title">
        <h1>
          <i class="fas fa-car-side"></i>
          إدارة موديلات السيارات
        </h1>
        <p>إدارة وتنظيم موديلات السيارات للعلامات التجارية المختلفة</p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="dashboard-content">
    <div class="container">
      
      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card models-stat">
          <div class="stat-icon">
            <i class="fas fa-car-side"></i>
          </div>
          <div class="stat-content">
            <h3>{{ statistics.totalModelTypes }}</h3>
            <p>إجمالي الموديلات</p>
            <div class="stat-trend">
              <i class="fas fa-arrow-up"></i>
              <span>نشط</span>
            </div>
          </div>
        </div>
        
        <div class="stat-card brands-stat">
          <div class="stat-icon">
            <i class="fas fa-car"></i>
          </div>
          <div class="stat-content">
            <h3>{{ statistics.totalBrands }}</h3>
            <p>إجمالي العلامات التجارية</p>
            <div class="stat-trend">
              <i class="fas fa-check-circle"></i>
              <span>متصل</span>
            </div>
          </div>
        </div>
        
        <div class="stat-card filtered-stat">
          <div class="stat-icon">
            <i class="fas fa-filter"></i>
          </div>
          <div class="stat-content">
            <h3>{{ filteredModelTypes.length }}</h3>
            <p>المعروضة حالياً</p>
            <div class="stat-trend">
              <i class="fas fa-eye"></i>
              <span>مرئية</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Bar -->
      <div class="action-bar">
        <div class="action-left">
          <button type="button" class="btn-primary" (click)="openCreateModal()">
            <i class="fas fa-plus"></i>
            إضافة موديل جديد
          </button>
          <button type="button" class="btn-secondary" (click)="refreshData()" [disabled]="loading">
            <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
            تحديث البيانات
          </button>
        </div>
        <div class="action-right">
          <div class="filters-row">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" 
                     [formControl]="searchTermControl" 
                     placeholder="البحث في الموديلات..." 
                     class="search-input">
            </div>
            <div class="filter-select">
              <i class="fas fa-car"></i>
              <select [formControl]="brandFilterControl" class="brand-filter">
                <option value="">جميع العلامات التجارية</option>
                <option *ngFor="let brand of brands" [value]="brand.id">
                  {{ brand.name }}
                </option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Data Card -->
      <div class="data-card">
        <div class="card-header">
          <h2>
            <i class="fas fa-list"></i>
            قائمة موديلات السيارات
          </h2>
          <div class="card-controls">
            <span class="data-count">
              عرض {{ filteredModelTypes.length }} من أصل {{ totalCount }} موديل
            </span>
            <div class="view-options">
              <label for="pageSize">العرض:</label>
              <select id="pageSize" (change)="onPageSizeChange($event)" class="size-selector">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card-body">
          <!-- Loading State -->
          <div *ngIf="loading" class="loading-state">
            <div class="loading-animation">
              <div class="spinner"></div>
              <p>جاري تحميل موديلات السيارات...</p>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="!loading && filteredModelTypes.length === 0" class="empty-state">
            <div class="empty-animation">
              <i class="fas fa-car-side"></i>
            </div>
            <h3>لا توجد موديلات</h3>
            <p>ابدأ بإضافة أول موديل سيارة</p>
            <button type="button" class="btn-primary" (click)="openCreateModal()">
              <i class="fas fa-plus"></i>
              إضافة موديل
            </button>
          </div>

          <!-- Data Grid -->
          <div *ngIf="!loading && filteredModelTypes.length > 0" class="models-grid">
            <div *ngFor="let modelType of filteredModelTypes; trackBy: trackByModelTypeId; let i = index" 
                 class="model-card" 
                 [class.even]="i % 2 === 0">
              
              <!-- Model Icon -->
              <div class="model-icon-section">
                <div class="icon-container">
                  <i class="fas fa-car-side"></i>
                  <span class="model-year">{{ modelType.year }}</span>
                </div>
              </div>

              <!-- Model Info -->
              <div class="model-info">
                <h3 class="model-name">{{ modelType.name }}</h3>
                <div class="model-details">
                  <div class="detail-item">
                    <i class="fas fa-car"></i>
                    <span>العلامة: {{ modelType.brandName || getBrandName(modelType.brandId) }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="fas fa-calendar"></i>
                    <span>السنة: {{ modelType.year }}</span>
                  </div>
                </div>
              </div>

              <!-- Model Actions -->
              <div class="model-actions">
                <button type="button" 
                        class="action-btn edit-btn" 
                        (click)="openEditModal(modelType)"
                        title="تعديل الموديل">
                  <i class="fas fa-edit"></i>
                </button>
                <button type="button" 
                        class="action-btn delete-btn" 
                        (click)="confirmDelete(modelType)"
                        title="حذف الموديل">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="card-footer" *ngIf="!loading && filteredModelTypes.length > 0">
          <div class="pagination-info">
            <span>الصفحة {{ currentPage }} من {{ totalPages }}</span>
          </div>
          <div class="pagination-controls">
            <button type="button" 
                    class="pagination-btn" 
                    [disabled]="currentPage === 1"
                    (click)="onPageChange(1)">
              <i class="fas fa-angle-double-right"></i>
            </button>
            <button type="button" 
                    class="pagination-btn" 
                    [disabled]="currentPage === 1"
                    (click)="onPageChange(currentPage - 1)">
              <i class="fas fa-angle-right"></i>
            </button>
            
            <div class="page-numbers">
              <button type="button" 
                      *ngFor="let page of getPaginationPages()"
                      class="page-btn"
                      [class.active]="page === currentPage"
                      (click)="onPageChange(page)">
                {{ page }}
              </button>
            </div>

            <button type="button" 
                    class="pagination-btn" 
                    [disabled]="currentPage === totalPages"
                    (click)="onPageChange(currentPage + 1)">
              <i class="fas fa-angle-left"></i>
            </button>
            <button type="button" 
                    class="pagination-btn" 
                    [disabled]="currentPage === totalPages"
                    (click)="onPageChange(totalPages)">
              <i class="fas fa-angle-double-left"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modern Create/Edit Modal -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
  <div class="modern-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">
        <i class="fas fa-car-side"></i>
        <h3>{{ modalMode === 'create' ? 'إضافة موديل جديد' : 'تعديل الموديل' }}</h3>
      </div>
      <button type="button" class="close-btn" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <strong>ملاحظة:</strong> عمليات إدارة الموديلات تتطلب تنفيذ خاص من خلال API العلامات التجارية.
      </div>
      
      <form [formGroup]="modelTypeForm" (ngSubmit)="saveModelType()">
        <div class="form-grid">
          <div class="form-group">
            <label for="name">
              <i class="fas fa-tag"></i>
              اسم الموديل
            </label>
            <input type="text" 
                   id="name" 
                   formControlName="name" 
                   class="form-input"
                   [class.error]="isFieldInvalid('name')"
                   placeholder="أدخل اسم الموديل">
            <div class="error-message" *ngIf="isFieldInvalid('name')">
              <i class="fas fa-exclamation-circle"></i>
              {{ getFieldError('name') }}
            </div>
          </div>
          
          <div class="form-group">
            <label for="year">
              <i class="fas fa-calendar"></i>
              السنة
            </label>
            <input type="number" 
                   id="year" 
                   formControlName="year" 
                   class="form-input"
                   [class.error]="isFieldInvalid('year')"
                   placeholder="أدخل السنة"
                   min="1900"
                   [max]="2030">
            <div class="error-message" *ngIf="isFieldInvalid('year')">
              <i class="fas fa-exclamation-circle"></i>
              {{ getFieldError('year') }}
            </div>
          </div>

          <div class="form-group full-width">
            <label for="brandId">
              <i class="fas fa-car"></i>
              العلامة التجارية
            </label>
            <select id="brandId" 
                    formControlName="brandId" 
                    class="form-input"
                    [class.error]="isFieldInvalid('brandId')">
              <option value="">اختر العلامة التجارية</option>
              <option *ngFor="let brand of brands" [value]="brand.id">
                {{ brand.name }}
              </option>
            </select>
            <div class="error-message" *ngIf="isFieldInvalid('brandId')">
              <i class="fas fa-exclamation-circle"></i>
              {{ getFieldError('brandId') }}
            </div>
            <div class="form-hint">
              <i class="fas fa-info-circle"></i>
              اختر العلامة التجارية التي ينتمي إليها هذا الموديل
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="closeModal()">
        <i class="fas fa-times"></i>
        إلغاء
      </button>
      <button type="button" 
              class="btn-save" 
              (click)="saveModelType()"
              [disabled]="modelTypeForm.invalid">
        <i class="fas fa-check"></i>
        {{ modalMode === 'create' ? 'إضافة الموديل' : 'حفظ التغييرات' }}
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="modelTypeToDelete" (click)="cancelDelete()">
  <div class="confirmation-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title danger">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>تأكيد حذف الموديل</h3>
      </div>
    </div>
    
    <div class="modal-body">
      <div class="confirmation-content">
        <div class="warning-icon">
          <i class="fas fa-trash-alt"></i>
        </div>
        <h4>هل أنت متأكد من الحذف؟</h4>
        <p>سيتم حذف الموديل:</p>
        <div class="model-info">
          <strong>{{ modelTypeToDelete?.name }}</strong>
          <span>{{ modelTypeToDelete?.year }} - {{ modelTypeToDelete?.brandName || getBrandName(modelTypeToDelete?.brandId || 0) }}</span>
        </div>
        <div class="warning-note">
          <i class="fas fa-exclamation-circle"></i>
          لا يمكن التراجع عن هذا الإجراء
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="cancelDelete()">
        <i class="fas fa-arrow-right"></i>
        العودة
      </button>
      <button type="button" class="btn-delete" (click)="deleteModelType()">
        <i class="fas fa-trash"></i>
        تأكيد الحذف
      </button>
    </div>
  </div>
</div>
