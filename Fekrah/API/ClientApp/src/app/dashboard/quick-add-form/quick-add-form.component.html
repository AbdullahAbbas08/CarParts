<form class="quick-add-form__content" [formGroup]="partForm" (ngSubmit)="submitForm()">
  <!-- معلومات القطعة -->
  <section class="form-section">
    <h3><i class="fas fa-cog"></i> معلومات القطعة</h3>

    <div class="form-row">
      <div class="form-group" style="flex:1;">
        <label for="name"><i class="fas fa-tag"></i> اسم القطعة *</label>
        <input
          type="text"
          id="name"
          list="partNamesList"
          formControlName="name"
          class="form-control"
          placeholder="اختر أو اكتب اسم القطعة"
          required>
        <datalist id="partNamesList">
          <option *ngFor="let n of partNames" [value]="n">{{ n }}</option>
        </datalist>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group" style="width: 100%;">
        <label for="subtitle"><i class="fas fa-info-circle"></i> وصف إضافي</label>
        <textarea id="subtitle" formControlName="subtitle" class="form-control textarea-auto" rows="2"
          style="width:100%;" placeholder="اكتب وصفًا مختصرًا للقطعة، مثل: حالتها أو تفاصيل إضافية..."></textarea>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="condition"><i class="fas fa-star"></i> الحالة *</label>
        <select formControlName="condition" class="form-control" required>
          <option value="">اختر الحالة</option>
          <option *ngFor="let c of conditions" [value]="c">{{ c }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="grade"><i class="fas fa-award"></i> الجودة *</label>
        <select formControlName="grade" class="form-control" required>
          <option value="">اختر الجودة</option>
          <option *ngFor="let g of grades" [value]="g">{{ g }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="partType"><i class="fas fa-globe"></i> النوع *</label>
        <select formControlName="partType" class="form-control" required>
          <option value="">اختر النوع</option>
          <option *ngFor="let t of partTypes" [value]="t">{{ t }}</option>
        </select>
      </div>
    </div>
  </section>


  <!-- معلومات السيارة -->
  <section class="form-section">
    <h3><i class="fas fa-car"></i> معلومات السيارة</h3>
    <div class="form-row">
      <div class="form-group">
        <label for="carBrand"><i class="fas fa-trademark"></i> الماركة *</label>
        <select formControlName="carBrand" class="form-control" required>
          <option value="">اختر أو اكتب الماركة</option>
          <option *ngFor="let brand of carBrands" [value]="brand">{{ brand }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="carModel"><i class="fas fa-car-side"></i> الموديل *</label>
        <select formControlName="carModel" class="form-control" required>
          <option value="">اختر أو اكتب الموديل</option>
          <option *ngFor="let model of carModels" [value]="model">{{ model }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="carYear"><i class="fas fa-calendar"></i> السنة *</label>
        <select formControlName="carYear" class="form-control" required>
          <option value="">اختر السنة</option>
          <option *ngFor="let year of years" [value]="year">{{ year }}</option>
        </select>
      </div>
    </div>
  </section>
  <!-- معلومات السعر -->
  <section class="form-section">
    <h3><i class="fas fa-dollar-sign"></i> معلومات السعر</h3>
    <div class="form-row">
      <div class="form-group">
        <label for="price"><i class="fas fa-money-bill"></i> السعر الأصلي *</label>
        <input type="number" id="price" formControlName="price" placeholder="0" class="form-control" required
          (input)="calculateDiscountedPrice()">
      </div>
      <div class="form-group">
        <label for="discount"><i class="fas fa-percentage"></i> نسبة الخصم %</label>
        <input type="number" id="discount" formControlName="discount" placeholder="0" class="form-control" min="0"
          max="100" (input)="calculateDiscountedPrice()">
      </div>
      <div class="form-group">
        <label for="priceAfterDiscount"><i class="fas fa-tag"></i> السعر النهائي</label>
        <input type="number" id="priceAfterDiscount" formControlName="priceAfterDiscount" placeholder="0"
          class="form-control" readonly>
      </div>
    </div>
  </section>
  <!-- معلومات إضافية -->
  <section class="form-section">
    <h3><i class="fas fa-plus"></i> معلومات إضافية</h3>
    <div class="form-row">
      <div class="form-group">
        <label for="origin"><i class="fas fa-flag"></i> بلد المنشأ</label>
        <input type="text" id="origin" formControlName="origin" placeholder="مثال: اليابان" class="form-control">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="hasDelivery">
          <span><i class="fas fa-truck"></i> يتوفر توصيل</span>
        </label>
      </div>
      <div class="form-group checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="isFavorite">
          <span><i class="fas fa-heart"></i> إضافة للمفضلة</span>
        </label>
      </div>
    </div>
  </section>
  <!-- الصور -->
  <section class="form-section">
    <h3><i class="fas fa-images"></i> الصور</h3>
    <div class="image-upload-area" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)" (click)="fileInput.click()">
      <div class="upload-content">
        <i class="fas fa-cloud-upload-alt"></i>
        <p>اسحب الصور هنا أو اضغط للاختيار</p>
        <button type="button" class="btn btn-outline" (click)="fileInput.click(); $event.stopPropagation();">
          <i class="fas fa-plus"></i> اختيار صور
        </button>
      </div>
      <div class="image-preview" *ngIf="images.length">
        <div class="image-item" *ngFor="let img of images; let i = index">
          <img [src]="img.url" [alt]="'صورة ' + (i+1)">
          <button type="button" class="btn-remove" (click)="removeImage(i)">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      <input #fileInput type="file" id="fileInput" accept="image/*" multiple style="display: none"
        (change)="onImageSelected($event)">
    </div>
  </section>
  <!-- الأزرار -->
  <div class="form-actions">
    <button type="button" class="btn btn-secondary" (click)="closeForm()">
      <i class="fas fa-times"></i> إلغاء
    </button>
    <button type="submit" class="btn btn-primary" [disabled]="!partForm.valid">
      <i class="fas fa-plus"></i> إضافة القطعة
    </button>
    <button type="button" class="btn btn-success" (click)="submitAndAddAnother()">
      <i class="fas fa-plus"></i> حفظ وإضافة أخرى
    </button>
  </div>
</form>
<div class="shortcuts-info">
  <small>
    <strong>اختصارات لوحة المفاتيح:</strong>
    Ctrl+Enter للحفظ | Ctrl+Shift+Enter للحفظ وإضافة أخرى | Esc للإلغاء
  </small>
</div>
