<div class="manage-merchants-container">
  
  <!-- Top Breadcrumb -->
  <nav class="top-breadcrumb-nav">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="/dashboard">
          <i class="fas fa-home"></i>
          ุงูุฑุฆูุณูุฉ
        </a>
      </li>
      <li class="breadcrumb-item">
        <a href="/admin">
          <i class="fas fa-user-shield"></i>
          ุงูุฅุฏุงุฑุฉ
        </a>
      </li>
      <li class="breadcrumb-item active">
        <i class="fas fa-store"></i>
        ุฅุฏุงุฑุฉ ุงูุชุฌุงุฑ
      </li>
    </ol>
  </nav>
  
  <!-- Enhanced Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="page-info">
        <div class="page-title-container">
          <div class="page-icon">
            <i class="fas fa-store"></i>
          </div>
          <div class="page-text">
            <h1 class="page-title">ุฅุฏุงุฑุฉ ุงูุชุฌุงุฑ</h1>
            <p class="page-description">ุฅุฏุงุฑุฉ ุดุงููุฉ ูุฌููุน ุงูุชุฌุงุฑ ูุงููุชุงุฌุฑ ุงููุณุฌูุฉ ูู ุงููุธุงู</p>
          </div>
        </div>
      </div>

      <div class="header-actions">
        <!-- View Mode Toggle -->
        <div class="view-mode-toggle">
          <button [class.active]="viewMode === 'cards'" 
                  (click)="setViewMode('cards')" 
                  class="view-btn"
                  title="ุนุฑุถ ุงูุจุทุงูุงุช">
            <i class="fas fa-th-large"></i>
            <span>ุจุทุงูุงุช</span>
          </button>
          <button [class.active]="viewMode === 'table'" 
                  (click)="setViewMode('table')" 
                  class="view-btn"
                  title="ุนุฑุถ ุงูุฌุฏูู">
            <i class="fas fa-table"></i>
            <span>ุฌุฏูู</span>
          </button>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="addNewMerchant()" title="ุฅุถุงูุฉ ุชุงุฌุฑ ุฌุฏูุฏ">
            <i class="fas fa-plus"></i>
            <span>ุฅุถุงูุฉ ุชุงุฌุฑ</span>
          </button>
          
          <button class="btn btn-secondary" (click)="refreshData()" title="ุชุญุฏูุซ ุงูุจูุงูุงุช">
            <i class="fas fa-sync" [class.fa-spin]="isLoading"></i>
            <span>ุชุญุฏูุซ</span>
          </button>
          
          <button class="btn btn-outline" (click)="exportData()" title="ุชุตุฏูุฑ ุงูุจูุงูุงุช">
            <i class="fas fa-download"></i>
            <span>ุชุตุฏูุฑ</span>
          </button>
          
          <div class="dropdown">
            <button class="btn btn-outline dropdown-toggle" 
                    (click)="toggleActionsDropdown()"
                    title="ุงููุฒูุฏ ูู ุงูุฅุฌุฑุงุกุงุช">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <div class="dropdown-menu" [class.show]="showActionsDropdown">
              <a class="dropdown-item" href="#">
                <i class="fas fa-upload text-info"></i>
                ุงุณุชูุฑุงุฏ ุจูุงูุงุช
              </a>
              <a class="dropdown-item" href="#">
                <i class="fas fa-chart-bar text-primary"></i>
                ุชูุฑูุฑ ููุตู
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Stats Bar -->
    <div class="quick-stats-bar">
      <div class="stat-item" [class.active]="selectedStatus === 'all'" (click)="quickFilterByStatus('all')">
        <div class="stat-icon total">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <span class="stat-number">{{ totalMerchants }}</span>
          <span class="stat-label">ุฅุฌูุงูู ุงูุชุฌุงุฑ</span>
        </div>
      </div>
      
      <div class="stat-item" [class.active]="selectedStatus === 'active'" (click)="quickFilterByStatus('active')">
        <div class="stat-icon active">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
          <span class="stat-number">{{ activeMerchants }}</span>
          <span class="stat-label">ูุดุท</span>
        </div>
      </div>
      
      <div class="stat-item" [class.active]="selectedStatus === 'inactive'" (click)="quickFilterByStatus('inactive')">
        <div class="stat-icon inactive">
          <i class="fas fa-times-circle"></i>
        </div>
        <div class="stat-content">
          <span class="stat-number">{{ inactiveMerchants }}</span>
          <span class="stat-label">ุบูุฑ ูุดุท</span>
        </div>
      </div>
      
      <div class="stat-item" [class.active]="selectedStatus === 'deleted'" (click)="quickFilterByStatus('deleted')">
        <div class="stat-icon deleted">
          <i class="fas fa-ban"></i>
        </div>
        <div class="stat-content">
          <span class="stat-number">{{ deletedMerchants }}</span>
          <span class="stat-label">ูุบูู</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Modern Filters Section -->
  <div class="filters-section">
    <!-- Search Container with Advanced Features -->
    <div class="search-container">
      <div class="search-box">
        <input 
          type="text" 
          class="search-input" 
          [class.searching]="isSearching"
          placeholder="๐ ุงุจุญุซ ุนู ุงูุชุฌุงุฑ ุจุงูุงุณูุ ุฑูู ุงููุงุชูุ ุฃู ุงูุนููุงู..."
          [(ngModel)]="searchTerm"
          (input)="onSearchInputChange($event)">
        
        <button 
          *ngIf="searchTerm" 
          class="clear-search" 
          (click)="clearSearch()"
          title="ูุณุญ ุงูุจุญุซ">
          <i class="fas fa-times"></i>
        </button>
        
        <i class="search-icon fas" 
           [class.fa-search]="!searchTerm"
           [class.fa-spinner]="searchTerm && isSearching"
           [class.fa-pulse]="searchTerm && isSearching"></i>
      </div>
      
      <div *ngIf="isSearching" class="search-loading">
        <i class="fas fa-circle-notch fa-spin"></i>
        <span>ุฌุงุฑู ุงูุจุญุซ...</span>
      </div>
    </div>

    <!-- Enhanced Filters Grid -->
    <div class="filters-grid">
      <!-- Governorate Filter with Enhanced UI -->
      <div class="filter-group">
        <label for="governorate" class="filter-label">
          <i class="fas fa-map-marker-alt" style="color: #667eea; margin-left: 8px;"></i>
          ุงููุญุงูุธุฉ
        </label>
        <select 
          id="governorate"
          class="filter-select" 
          [(ngModel)]="selectedGovernorate" 
          (change)="onGovernorateChange()">
          <option value="">ุฌููุน ุงููุญุงูุธุงุช</option>
          <option *ngFor="let gov of governorates" [value]="gov.id">{{gov.name}}</option>
        </select>
      </div>

      <!-- City Filter with Enhanced UI -->
      <div class="filter-group">
        <label for="city" class="filter-label">
          <i class="fas fa-city" style="color: #667eea; margin-left: 8px;"></i>
          ุงููุฏููุฉ
        </label>
        <select 
          id="city"
          class="filter-select" 
          [(ngModel)]="selectedCity" 
          (change)="onCityChange()"
          [disabled]="!selectedGovernorate">
          <option value="">ุฌููุน ุงููุฏู</option>
          <option *ngFor="let city of cities" [value]="city.id">{{city.nameAr}}</option>
        </select>
      </div>

      <!-- Status Filter with Enhanced UI -->
      <div class="filter-group">
        <label for="status" class="filter-label">
          <i class="fas fa-circle" style="color: #667eea; margin-left: 8px;"></i>
          ุงูุญุงูุฉ
        </label>
        <select 
          id="status"
          class="filter-select" 
          [(ngModel)]="selectedStatus" 
          (change)="onStatusChange()">
          <option value="all">ุฌููุน ุงูุญุงูุงุช</option>
          <option value="active">ูุดุท ๐ข</option>
          <option value="inactive">ุบูุฑ ูุดุท ๐ด</option>
          <option value="deleted">ูุบูู โซ</option>
        </select>
      </div>

      <!-- Items Per Page Filter -->
      <div class="filter-group">
        <label for="itemsPerPage" class="filter-label">
          <i class="fas fa-list" style="color: #667eea; margin-left: 8px;"></i>
          ุงูุนุฑุถ
        </label>
        <select 
          id="itemsPerPage"
          class="filter-select" 
          [(ngModel)]="itemsPerPage" 
          (change)="updateItemsPerPage()">
          <option value="12">12 ุนูุตุฑ</option>
          <option value="24">24 ุนูุตุฑ</option>
          <option value="48">48 ุนูุตุฑ</option>
          <option value="96">96 ุนูุตุฑ</option>
        </select>
      </div>
    </div>

    <!-- Filter Actions moved below inputs -->
    <div class="filter-actions">
      <button 
        *ngIf="hasActiveFilters()"
        class="clear-filters-btn" 
        (click)="clearFilters()"
        title="ูุณุญ ุฌููุน ุงูููุงุชุฑ">
        <i class="fas fa-eraser"></i>
        <span>ูุณุญ ุงูููุงุชุฑ</span>
      </button>
      
      <button 
        class="advanced-filters-btn"
        [class.active]="showAdvancedFilters"
        (click)="toggleAdvancedFilters()"
        title="ููุงุชุฑ ูุชูุฏูุฉ">
        <i class="fas" [class.fa-sliders-h]="!showAdvancedFilters" [class.fa-times]="showAdvancedFilters"></i>
        <span>{{ showAdvancedFilters ? 'ุฅุฎูุงุก' : 'ูุชูุฏู' }}</span>
      </button>
    </div>

    <!-- Advanced Filters Section -->
    <div class="advanced-filters" *ngIf="showAdvancedFilters">
      <div class="advanced-filters-grid">
        <div class="filter-group">
          <label for="registrationDate" class="filter-label">
            <i class="fas fa-calendar-alt" style="color: #667eea; margin-left: 8px;"></i>
            ุชุงุฑูุฎ ุงูุชุณุฌูู
          </label>
          <select id="registrationDate" class="filter-select" [(ngModel)]="registrationDateFilter" (change)="onDateFilterChange()">
            <option value="">ุฌููุน ุงูุชูุงุฑูุฎ</option>
            <option value="today">ุงูููู</option>
            <option value="week">ูุฐุง ุงูุฃุณุจูุน</option>
            <option value="month">ูุฐุง ุงูุดูุฑ</option>
            <option value="year">ูุฐุง ุงูุนุงู</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="merchantType" class="filter-label">
            <i class="fas fa-store" style="color: #667eea; margin-left: 8px;"></i>
            ููุน ุงูุชุงุฌุฑ
          </label>
          <select id="merchantType" class="filter-select" [(ngModel)]="merchantTypeFilter" (change)="onTypeFilterChange()">
            <option value="">ุฌููุน ุงูุฃููุงุน</option>
            <option value="retailer">ุชุฌุฒุฆุฉ</option>
            <option value="wholesaler">ุฌููุฉ</option>
            <option value="manufacturer">ูุตูุน</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="sortBy" class="filter-label">
            <i class="fas fa-sort" style="color: #667eea; margin-left: 8px;"></i>
            ุชุฑุชูุจ ุญุณุจ
          </label>
          <select id="sortBy" class="filter-select" [(ngModel)]="sortBy" (change)="onSortChange()">
            <option value="name">ุงูุงุณู</option>
            <option value="date">ุชุงุฑูุฎ ุงูุชุณุฌูู</option>
            <option value="status">ุงูุญุงูุฉ</option>
            <option value="location">ุงููููุน</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="sortOrder" class="filter-label">
            <i class="fas fa-arrow-up-down" style="color: #667eea; margin-left: 8px;"></i>
            ุงุชุฌุงู ุงูุชุฑุชูุจ
          </label>
          <select id="sortOrder" class="filter-select" [(ngModel)]="sortOrder" (change)="onSortChange()">
            <option value="asc">ุชุตุงุนุฏู โ</option>
            <option value="desc">ุชูุงุฒูู โ</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
    </div>
    <p class="loading-text">ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุชุฌุงุฑ...</p>
  </div>

  <!-- Content Area -->
  <div *ngIf="!isLoading" class="content-area">
    
    <!-- No Results -->
    <div *ngIf="getPaginatedMerchants().length === 0" class="no-results">
      <div class="no-results-icon">
        <i class="fas fa-store-slash"></i>
      </div>
      <h3>ูุง ุชูุฌุฏ ูุชุงุฆุฌ</h3>
      <p *ngIf="hasActiveFilters()">ูู ูุชู ุงูุนุซูุฑ ุนูู ุชุฌุงุฑ ูุทุงุจููู ูุนุงููุฑ ุงูุจุญุซ ุงููุญุฏุฏุฉ</p>
      <p *ngIf="!hasActiveFilters()">ูุง ุชูุฌุฏ ุชุฌุงุฑ ูุณุฌููู ูู ุงููุธุงู ุญุงููุงู</p>
      <button *ngIf="hasActiveFilters()" (click)="clearFilters()" class="btn btn-primary">
        <i class="fas fa-filter"></i>
        ูุณุญ ุงูููุงุชุฑ
      </button>
    </div>

    <!-- Table View -->
    <div *ngIf="getPaginatedMerchants().length > 0 && viewMode === 'table'" class="table-container">
      <div class="table-header">
        <div class="table-info">
          <span class="results-text">{{ getResultsText() }}</span>
        </div>
        <div class="table-actions">
          <div class="table-controls">
            <button class="control-btn" (click)="refreshData()" title="ุชุญุฏูุซ ุงูุจูุงูุงุช">
              <i class="fas fa-sync" [class.fa-spin]="isLoading"></i>
              ุชุญุฏูุซ
            </button>
            <button class="control-btn" (click)="exportData()" title="ุชุตุฏูุฑ ุงูุจูุงูุงุช">
              <i class="fas fa-download"></i>
              ุชุตุฏูุฑ
            </button>
          </div>
        </div>
      </div>

      <div class="table-wrapper">
        <table class="merchants-table">
          <thead>
            <tr>
              <th class="sortable" (click)="changeSortBy('name')" 
                  [class.sorted]="sortBy === 'name'"
                  *ngIf="visibleColumns.name">
                <div class="th-content">
                  <span>ุงุณู ุงููุชุฌุฑ</span>
                  <i class="fas fa-sort sort-icon"></i>
                </div>
              </th>
              
              <th *ngIf="visibleColumns.contact">ูุนูููุงุช ุงูุงุชุตุงู</th>
              <th *ngIf="visibleColumns.location">ุงููููุน</th>
              <th *ngIf="visibleColumns.status">ุงูุญุงูุฉ</th>
              <th *ngIf="visibleColumns.joinDate">ุชุงุฑูุฎ ุงูุงูุถูุงู</th>
              <th class="actions-column">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          
          <tbody>
            <tr *ngFor="let merchant of getPaginatedMerchants(); trackBy: trackByMerchantId; let i = index"
                class="merchant-row"
                [attr.data-status]="getMerchantStatus(merchant)">

              <td class="merchant-name-cell" *ngIf="visibleColumns.name">
                <div class="merchant-info-compact">
                  <div class="merchant-avatar">
                    <div class="status-indicator" 
                         [class]="'status-' + getMerchantStatus(merchant)">
                    </div>
                  </div>
                  <div class="name-info">
                    <div class="store-name">{{ merchant.shopName }}</div>
                  </div>
                </div>
              </td>

              <td class="contact-cell" *ngIf="visibleColumns.contact">
                <div class="contact-info">
                  <div class="contact-item" *ngIf="merchant.mobileNo">
                    <i class="fas fa-phone"></i>
                    <span>{{ merchant.mobileNo }}</span>
                  </div>
                </div>
              </td>

              <td class="location-cell" *ngIf="visibleColumns.location">
                <div class="location-info">
                  <div class="location-text">
                    <span>{{ getGovernorateName(merchant.governorateId || 0) }}</span>
                    <span class="city-name">{{ merchant?.city?.nameAr }}</span>
                  </div>
                </div>
              </td>

              <td class="status-cell" *ngIf="visibleColumns.status">
                <span class="status-badge" [class]="getMerchantStatusClass(merchant)">
                  <i class="fas fa-circle"></i>
                  {{ getMerchantStatusLabel(merchant) }}
                </span>
              </td>

              <td class="join-date-cell" *ngIf="visibleColumns.joinDate">
                <div class="date-info">
                  <span class="date-main">ููุฐ ุดูุฑ</span>
                </div>
              </td>

              <td class="actions-cell">
                <div class="table-actions">
                   <div class="dropdown-container">
                    <button class="action-btn more-btn" 
                            (click)="toggleDropdown(merchant.id || 0)"
                            title="ุงููุฒูุฏ">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <div class="dropdown-menu" [class.show]="showDropdown[merchant.id || 0]">
                      <a class="dropdown-item" 
                         *ngIf="getMerchantStatus(merchant) !== 'deleted'"
                         (click)="deleteMerchant(merchant)">
                        <i class="fas fa-ban"></i>
                        ุฅุบูุงู ุงููุชุฌุฑ
                      </a>
                      <a class="dropdown-item" 
                         *ngIf="getMerchantStatus(merchant) === 'deleted'"
                         (click)="reactivateMerchant(merchant)">
                        <i class="fas fa-undo"></i>
                        ุฅุนุงุฏุฉ ุชูุนูู ุงููุชุฌุฑ
                      </a>
                    </div>
                  </div>

                  <button (click)="viewMerchant(merchant)" 
                          class="action-btn view-btn"
                          title="ุนุฑุถ ุงูุชูุงุตูู">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button (click)="editMerchant(merchant)" 
                          class="action-btn edit-btn"
                          title="ุชุนุฏูู">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button (click)="openLocationOnMap(merchant)" 
                          class="action-btn map-btn"
                          title="ุนุฑุถ ุนูู ุงูุฎุฑูุทุฉ">
                    <i class="fas fa-map-marker-alt"></i>
                  </button>
                  <button (click)="toggleMerchantStatus(merchant)" 
                          class="action-btn toggle-btn"
                          [title]="getMerchantStatus(merchant) === 'active' ? 'ุฅูุบุงุก ุงูุชูุนูู' : 'ุชูุนูู'">
                    <i [class]="getMerchantStatus(merchant) === 'active' ? 'fas fa-pause' : 'fas fa-play'"></i>
                  </button>
                  
                 
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Cards View -->
    <div *ngIf="getPaginatedMerchants().length > 0 && viewMode === 'cards'" class="merchants-grid">
      <div *ngFor="let merchant of getPaginatedMerchants(); trackBy: trackByMerchantId" 
           class="merchant-card"
           [attr.data-status]="getMerchantStatus(merchant)">
        
        <!-- Card Header -->
        <div class="card-header">
          <div class="merchant-avatar">
            <img [src]="merchant.logo || '/assets/images/default-store.png'" 
                 [alt]="merchant.shopName"
                 (error)="onImageError($event)"
                 class="avatar-image">
            <div class="status-indicator" 
                 [class]="'status-' + getMerchantStatus(merchant)">
            </div>
          </div>
          
          <div class="merchant-info">
            <h3 class="merchant-name">{{ merchant.shopName }}</h3>
            <div class="merchant-meta">
              <span class="merchant-id">#{{ merchant.id }}</span>
              <span class="status-badge" [class]="getMerchantStatusClass(merchant)">
                {{ getMerchantStatusLabel(merchant) }}
              </span>
            </div>
          </div>

          <!-- Actions Dropdown -->
          <div class="card-actions">
            <button class="actions-btn" (click)="toggleDropdown(merchant.id!)">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <div *ngIf="showDropdown[merchant.id!]" class="actions-dropdown">
              <button (click)="viewMerchant(merchant); showDropdown[merchant.id!] = false" 
                      class="dropdown-item">
                <i class="fas fa-eye"></i>
                ุนุฑุถ ุงูุชูุงุตูู
              </button>
              <button (click)="editMerchant(merchant); showDropdown[merchant.id!] = false" 
                      class="dropdown-item">
                <i class="fas fa-edit"></i>
                ุชุนุฏูู
              </button>
              <button (click)="toggleMerchantStatus(merchant); showDropdown[merchant.id!] = false" 
                      class="dropdown-item">
                <i class="fas" [class.fa-toggle-on]="getMerchantStatus(merchant) === 'active'"
                               [class.fa-toggle-off]="getMerchantStatus(merchant) !== 'active'"></i>
                {{ getMerchantStatus(merchant) === 'active' ? 'ุฅูุบุงุก ุงูุชูุนูู' : 'ุชูุนูู' }}
              </button>
              <button (click)="deleteMerchant(merchant); showDropdown[merchant.id!] = false" 
                      class="dropdown-item danger">
                <i class="fas fa-trash"></i>
                ุฅุบูุงู ุงููุชุฌุฑ
              </button>
            </div>
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <!-- Contact Information -->
          <div class="contact-section">
            <div class="contact-item" *ngIf="merchant.email">
              <i class="fas fa-envelope"></i>
              <span>{{ merchant.email }}</span>
            </div>
            <div class="contact-item" *ngIf="merchant.mobileNo">
              <i class="fas fa-phone"></i>
              <span>{{ merchant.mobileNo }}</span>
            </div>
          </div>

          <!-- Location Information -->
          <div class="location-section">
            <div class="location-item">
              <i class="fas fa-map-marker-alt"></i>
              <span>
                {{ getGovernorateName(merchant.governorateId || 0) }}
                <span *ngIf="merchant.cityId"> - {{ getCityName(merchant.cityId) }}</span>
              </span>
            </div>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="card-footer">
          <div class="quick-actions">
            <button (click)="viewMerchant(merchant)" class="quick-action-btn primary">
              <i class="fas fa-eye"></i>
              ุนุฑุถ
            </button>
            <button (click)="editMerchant(merchant)" class="quick-action-btn secondary">
              <i class="fas fa-edit"></i>
              ุชุนุฏูู
            </button>
            <button *ngIf="merchant.locationOnMap" 
                    (click)="openLocationOnMap(merchant)" 
                    class="quick-action-btn info">
              <i class="fas fa-map-marked-alt"></i>
              ุงููููุน
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Summary -->
    <div *ngIf="getPaginatedMerchants().length > 0" class="results-summary">
      <span class="results-text">{{ getResultsText() }}</span>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination-wrapper">
        <button class="pagination-btn" 
                [disabled]="currentPage === 1"
                (click)="previousPage()">
          <i class="fas fa-chevron-right"></i>
          ุงูุณุงุจู
        </button>

        <div class="pagination-pages">
          <button class="pagination-btn page-btn" 
                  *ngFor="let page of getVisiblePages()"
                  [class.active]="page === currentPage"
                  [disabled]="page === -1"
                  (click)="page !== -1 && goToPage(page)">
            {{ page === -1 ? '...' : page }}
          </button>
        </div>

        <button class="pagination-btn" 
                [disabled]="currentPage === totalPages"
                (click)="nextPage()">
          ุงูุชุงูู
          <i class="fas fa-chevron-left"></i>
        </button>
      </div>
    </div>
  </div>
<!-- </div> -->
