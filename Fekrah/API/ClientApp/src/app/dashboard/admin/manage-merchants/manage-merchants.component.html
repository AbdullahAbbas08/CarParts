<div class="manage-merchants-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-store"></i>
        ุฅุฏุงุฑุฉ ุงูุชุฌุงุฑ
      </h1>
      <p class="page-description">
        ุฅุฏุงุฑุฉ ูุนุฑุถ ุฌููุน ุงูุชุฌุงุฑ ุงููุณุฌููู ูู ุงูููุตุฉ
      </p>
    </div>
    
    <div class="header-actions">
      <button class="btn btn-primary" (click)="addNewMerchant()">
        <i class="fas fa-plus"></i>
        ุฅุถุงูุฉ ุชุงุฌุฑ ุฌุฏูุฏ
      </button>
      <button class="btn btn-secondary" (click)="refreshData()">
        <i class="fas fa-sync"></i>
        ุชุญุฏูุซ
      </button>
      <button class="btn btn-outline" (click)="exportData()">
        <i class="fas fa-download"></i>
        ุชุตุฏูุฑ
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon total">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-info">
        <div class="stat-number">{{ getTotalCount() }}</div>
        <div class="stat-label">ุฅุฌูุงูู ุงูุชุฌุงุฑ</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon active">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-info">
        <div class="stat-number">{{ getActiveCount() }}</div>
        <div class="stat-label">ุงูุชุฌุงุฑ ุงููุดุทูู</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon inactive">
        <i class="fas fa-times-circle"></i>
      </div>
      <div class="stat-info">
        <div class="stat-number">{{ getInactiveCount() }}</div>
        <div class="stat-label">ุบูุฑ ุงููุดุทูู</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon deleted">
        <i class="fas fa-ban"></i>
      </div>
      <div class="stat-info">
        <div class="stat-number">{{ getDeletedCount() }}</div>
        <div class="stat-label">ุงููุบููุฉ</div>
      </div>
    </div>
  </div>

  <!-- Enhanced Search and Filters -->
  <div class="filters-container">
    <!-- Search Bar with Advanced Style -->
    <div class="search-section">
      <div class="search-wrapper">
        <div class="search-box">
          <div class="search-icon">
            <i class="fas fa-search"></i>
          </div>
          <input 
            type="text" 
            class="search-input" 
            placeholder="ุงูุจุญุซ ูู ุฃุณูุงุก ุงููุชุงุฌุฑุ ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ุฃู ุฑูู ุงููุงุชู..."
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()">
          <button class="clear-btn" *ngIf="searchTerm" (click)="searchTerm=''; onSearchChange()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <!-- Quick Search Suggestions -->
        <div class="search-suggestions" *ngIf="searchTerm && searchTerm.length > 0">
          <div class="suggestion-item">
            <i class="fas fa-clock"></i>
            <span>ุงูุจุญุซ ุนู: "{{ searchTerm }}"</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Modern Filter Cards -->
    <div class="filters-grid">
      <!-- Status Filter Card -->
      <div class="filter-card">
        <div class="filter-header">
          <i class="fas fa-toggle-on"></i>
          <span>ุญุงูุฉ ุงูุชุงุฌุฑ</span>
        </div>
        <select [(ngModel)]="selectedStatus" (change)="onStatusChange()" class="modern-select">
          <option value="all">ุฌููุน ุงูุญุงูุงุช</option>
          <option value="active">๐ข ูุดุท</option>
          <option value="inactive">๐ก ุบูุฑ ูุดุท</option>
          <option value="deleted">๐ด ูุบูู</option>
        </select>
      </div>

      <!-- Location Filter Card -->
      <div class="filter-card">
        <div class="filter-header">
          <i class="fas fa-map-marker-alt"></i>
          <span>ุงููููุน ุงูุฌุบุฑุงูู</span>
        </div>
        <div class="location-filters">
          <select [(ngModel)]="selectedGovernorate" (change)="onGovernorateChange()" class="modern-select">
            <option value="">ุงุฎุชุฑ ุงููุญุงูุธุฉ</option>
            <option *ngFor="let gov of governorates" [value]="gov.id">{{ gov.name }}</option>
          </select>
          <select [(ngModel)]="selectedCity" (change)="onCityChange()" 
                  [disabled]="!selectedGovernorate" class="modern-select">
            <option value="">ุงุฎุชุฑ ุงููุฏููุฉ</option>
            <option *ngFor="let city of cities" [value]="city.id">{{ city.nameAr }}</option>
          </select>
        </div>
      </div>

      <!-- Sort & Actions Card -->
      <div class="filter-card">
        <div class="filter-header">
          <i class="fas fa-sort"></i>
          <span>ุงูุชุฑุชูุจ ูุงูุฅุฌุฑุงุกุงุช</span>
        </div>
        <div class="sort-actions">
          <select [(ngModel)]="sortBy" (change)="applyFilters()" class="modern-select">
            <option value="date">ุงูุฃุญุฏุซ</option>
            <option value="name">ุงูุงุณู (ุฃ-ู)</option>
            <option value="rating">ุงูุชูููู</option>
            <option value="orders">ุนุฏุฏ ุงูุทูุจุงุช</option>
          </select>
          <button class="sort-direction-btn" (click)="changeSortBy(sortBy)">
            <i class="fas" [ngClass]="sortDirection === 'asc' ? 'fa-sort-up' : 'fa-sort-down'"></i>
          </button>
        </div>
      </div>

      <!-- Clear Filters Card -->
      <div class="filter-card action-card">
        <button class="clear-filters-btn" (click)="clearFilters()">
          <i class="fas fa-refresh"></i>
          <span>ูุณุญ ุฌููุน ุงูููุงุชุฑ</span>
        </button>
        <div class="active-filters" *ngIf="hasActiveFilters()">
          <span class="filter-count">{{ getActiveFiltersCount() }} ููุงุชุฑ ูุดุทุฉ</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modern Data Table -->
  <div class="table-wrapper" *ngIf="!isLoading">
    <div class="table-header">
      <div class="table-title">
        <h3>ูุงุฆูุฉ ุงูุชุฌุงุฑ</h3>
        <span class="table-subtitle">{{ getResultsText() }}</span>
      </div>
      <div class="table-controls">
        <div class="view-options">
          <button class="view-btn" [class.active]="viewMode === 'list'" (click)="viewMode = 'list'">
            <i class="fas fa-list"></i>
          </button>
          <button class="view-btn" [class.active]="viewMode === 'grid'" (click)="viewMode = 'grid'">
            <i class="fas fa-th-large"></i>
          </button>
        </div>
        <div class="items-per-page">
          <span>ุนุฑุถ</span>
          <select [(ngModel)]="itemsPerPage" (change)="updateItemsPerPage()" class="compact-select">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <span>ุนูุตุฑ</span>
        </div>
      </div>
    </div>

    <!-- List View -->
    <div class="merchants-table-container" *ngIf="viewMode === 'list'">
      <!-- Loading State -->
      <div class="table-loading-container" *ngIf="isLoading">
        <div class="loading-spinner">
          <div class="spinner-ring"></div>
          <div class="spinner-ring"></div>
          <div class="spinner-ring"></div>
        </div>
        <p class="loading-text">ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุชุฌุงุฑ...</p>
      </div>

      <!-- Table Content -->
      <table class="modern-table" *ngIf="!isLoading">
        <thead>
          <tr>
            <th class="sortable merchant-info-header" (click)="changeSortBy('name')">
              <div class="th-content">
                <span>ุจูุงูุงุช ุงูุชุงุฌุฑ</span>
                <i class="fas fa-sort" *ngIf="sortBy !== 'name'"></i>
                <i class="fas fa-sort-up" *ngIf="sortBy === 'name' && sortDirection === 'asc'"></i>
                <i class="fas fa-sort-down" *ngIf="sortBy === 'name' && sortDirection === 'desc'"></i>
              </div>
            </th>
            <th class="location-contact-header">ุงููููุน ูุงูุชูุงุตู</th>
            <th class="status-header">ุงูุญุงูุฉ</th>
            <th class="actions-header">ุงูุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let merchant of getPaginatedMerchants(); trackBy: trackByMerchantId" 
              class="merchant-row" [attr.data-status]="getMerchantStatus(merchant)">
            
            <!-- Merchant Info Enhanced -->
            <td class="merchant-info-cell">
              <div class="merchant-profile">
                <div class="merchant-avatar-wrapper">
                  <img [src]="merchant.logo || '/assets/images/default-store.png'" 
                       [alt]="merchant.shopName"
                       (error)="onImageError($event)"
                       class="merchant-avatar-img">
                  
                  <!-- Status Indicator -->
                  <div class="status-indicator" [ngClass]="getMerchantStatusClass(merchant)"></div>
                  
                  <!-- Map Badge -->
                  <div class="map-badge" *ngIf="merchant.locationOnMap" title="ูุธูุฑ ุนูู ุงูุฎุฑูุทุฉ">
                    <i class="fas fa-map-marked-alt"></i>
                  </div>
                </div>
                
                <div class="merchant-info-details">
                  <div class="merchant-name-section">
                    <h4 class="merchant-name">{{ merchant.shopName }}</h4>
                    <span class="merchant-id-badge" *ngIf="merchant.nationalIdNumber">
                      ID: {{ merchant.nationalIdNumber }}
                    </span>
                  </div>
                  
                  <div class="merchant-contact">
                    <div class="contact-item email">
                      <i class="fas fa-envelope"></i>
                      <span>{{ merchant.email }}</span>
                    </div>
                    <div class="contact-item phone">
                      <i class="fas fa-phone"></i>
                      <span>{{ merchant.mobileNo }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </td>

            <!-- Location & Address -->
            <td class="location-cell">
              <div class="location-info-enhanced">
                <div class="location-row">
                  <div class="location-icon">
                    <i class="fas fa-map-marker-alt"></i>
                  </div>
                  <div class="location-details">
                    <span class="governorate">{{ getGovernorateName(merchant.governorateId || 0) }}</span>
                    <span class="city" *ngIf="merchant.cityId">{{ getCityName(merchant.cityId) }}</span>
                  </div>
                </div>
                <div class="address-row" *ngIf="merchant.address">
                  <i class="fas fa-home"></i>
                  <span class="address">{{ merchant.address }}</span>
                </div>
                <div class="map-row" *ngIf="merchant.locationOnMap">
                  <button class="map-link-btn" (click)="openLocationOnMap(merchant)" title="ุนุฑุถ ุนูู ุงูุฎุฑูุทุฉ">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>ุนุฑุถ ุนูู ุงูุฎุฑูุทุฉ</span>
                  </button>
                </div>
              </div>
            </td>

            <!-- Status Enhanced -->
            <td class="status-cell">
              <div class="status-wrapper">
                <span class="status-badge-modern" [ngClass]="getMerchantStatusClass(merchant)">
                  <div class="status-dot"></div>
                  <span class="status-text">{{ getMerchantStatusLabel(merchant) }}</span>
                </span>
              </div>
            </td>

            <!-- Actions Enhanced -->
            <td class="actions-cell">
              <div class="actions-wrapper">
                <div class="primary-actions">
                  <button class="action-btn-modern view" 
                          (click)="viewMerchant(merchant)"
                          title="ุนุฑุถ ุงูุชูุงุตูู">
                    <i class="fas fa-eye"></i>
                  </button>
                  
                  <button class="action-btn-modern edit" 
                          (click)="editMerchant(merchant)"
                          title="ุชุนุฏูู ุงูุจูุงูุงุช">
                    <i class="fas fa-edit"></i>
                  </button>
                </div>

                <div class="dropdown-actions">
                  <button class="more-actions-btn" (click)="toggleDropdown(merchant.id)">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                  
                  <div class="actions-dropdown" [class.show]="showDropdown[merchant.id!]">
                    <button class="dropdown-item" 
                            *ngIf="getMerchantStatus(merchant) === 'active'"
                            (click)="toggleMerchantStatus(merchant)">
                      <i class="fas fa-pause"></i>
                      <span>ุฅูุบุงุก ุงูุชูุนูู</span>
                    </button>

                    <button class="dropdown-item" 
                            *ngIf="getMerchantStatus(merchant) === 'inactive'"
                            (click)="toggleMerchantStatus(merchant)">
                      <i class="fas fa-play"></i>
                      <span>ุชูุนูู</span>
                    </button>

                    <button class="dropdown-item danger" 
                            *ngIf="getMerchantStatus(merchant) !== 'deleted'"
                            (click)="deleteMerchant(merchant)">
                      <i class="fas fa-ban"></i>
                      <span>ุฅุบูุงู ุงููุชุฌุฑ</span>
                    </button>

                    <button class="dropdown-item success" 
                            *ngIf="getMerchantStatus(merchant) === 'deleted'"
                            (click)="reactivateMerchant(merchant)">
                      <i class="fas fa-undo"></i>
                      <span>ุฅุนุงุฏุฉ ุชูุนูู</span>
                    </button>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Grid View -->
    <div class="merchants-grid" *ngIf="viewMode === 'grid'">
      <!-- Loading State for Grid -->
      <div class="grid-loading-container" *ngIf="isLoading">
        <div class="loading-spinner">
          <div class="spinner-ring"></div>
          <div class="spinner-ring"></div>
          <div class="spinner-ring"></div>
        </div>
        <p class="loading-text">ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุชุฌุงุฑ...</p>
      </div>

      <!-- Grid Content -->
      <div class="merchant-card" 
           *ngFor="let merchant of getPaginatedMerchants(); trackBy: trackByMerchantId"
           [attr.data-status]="getMerchantStatus(merchant)"
           [style.display]="isLoading ? 'none' : 'block'">
        
        <div class="card-header">
          <div class="merchant-avatar-card">
            <img [src]="merchant.logo || '/assets/images/default-store.png'" 
                 [alt]="merchant.shopName"
                 (error)="onImageError($event)">
            <div class="status-indicator-card" [ngClass]="getMerchantStatusClass(merchant)"></div>
          </div>
          
          <div class="card-actions">
            <button class="card-action-btn" (click)="viewMerchant(merchant)">
              <i class="fas fa-eye"></i>
            </button>
            <button class="card-action-btn" (click)="editMerchant(merchant)">
              <i class="fas fa-edit"></i>
            </button>
          </div>
        </div>

        <div class="card-body">
          <h3 class="card-title">{{ merchant.shopName }}</h3>
          
          <div class="card-rating">
            <span class="rating-score">{{ (merchant.rating || 0).toFixed(1) }}</span>
            <div class="stars-small">
              <i class="fas fa-star" 
                 *ngFor="let i of [1,2,3,4,5]" 
                 [class.filled]="(merchant.rating || 0) >= i"></i>
            </div>
            <span class="rating-count">({{ merchant.ratingCount || 0 }})</span>
          </div>

          <div class="card-location">
            <i class="fas fa-map-marker-alt"></i>
            <span>{{ getGovernorateName(merchant.governorateId || 0) }}</span>
          </div>

          <div class="card-contact">
            <div class="contact-info">
              <i class="fas fa-phone"></i>
              <span>{{ merchant.mobileNo }}</span>
            </div>
          </div>
        </div>

        <div class="card-footer">
          <div class="status-badge-card" [ngClass]="getMerchantStatusClass(merchant)">
            {{ getMerchantStatusLabel(merchant) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Empty State -->
    <div class="empty-state-modern" *ngIf="!isLoading && getPaginatedMerchants().length === 0">
      <div class="empty-illustration">
        <i class="fas fa-store-slash"></i>
      </div>
      <div class="empty-content">
        <h3>ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ</h3>
        <p>ูู ูุชู ุงูุนุซูุฑ ุนูู ุชุฌุงุฑ ูุทุงุจููู ูุนุงููุฑ ุงูุจุญุซ ูุงูููุงุชุฑ ุงููุญุฏุฏุฉ</p>
        <div class="empty-actions">
          <button class="btn btn-primary" (click)="clearFilters()">
            <i class="fas fa-refresh"></i>
            ูุณุญ ุงูููุงุชุฑ
          </button>
          <button class="btn btn-secondary" (click)="addNewMerchant()">
            <i class="fas fa-plus"></i>
            ุฅุถุงูุฉ ุชุงุฌุฑ ุฌุฏูุฏ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="!isLoading && getPaginatedMerchants().length > 0">
    <button class="pagination-btn" 
            [disabled]="currentPage === 1"
            (click)="previousPage()">
      <i class="fas fa-chevron-right"></i>
      ุงูุณุงุจู
    </button>

    <div class="pagination-pages">
      <button class="pagination-btn page-btn" 
              *ngFor="let page of getVisiblePages()"
              [class.active]="page === currentPage"
              [disabled]="page === -1"
              (click)="page !== -1 && goToPage(page)">
        {{ page === -1 ? '...' : page }}
      </button>
    </div>

    <button class="pagination-btn" 
            [disabled]="currentPage === totalPages"
            (click)="nextPage()">
      ุงูุชุงูู
      <i class="fas fa-chevron-left"></i>
    </button>
  </div>
</div>
