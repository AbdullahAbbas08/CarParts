<!-- User Management Component with Modern Arabic Design -->
<div class="user-management" style="font-family: 'Cairo', sans-serif; direction: rtl; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;">
  
  <!-- Header Section -->
  <div class="management-header" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding: 2rem;">
    <div class="container-fluid">
      <!-- Breadcrumb -->
      <nav class="breadcrumb-nav" style="margin-bottom: 1rem;">
        <ol class="breadcrumb" style="display: flex; align-items: center; gap: 1rem; margin: 0; padding: 0; list-style: none; color: rgba(255, 255, 255, 0.8);">
          <li class="breadcrumb-item">
            <a routerLink="/admin" style="color: rgba(255, 255, 255, 0.9); text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-shield-alt"></i>
              لوحة الإدارة
            </a>
          </li>
          <li class="breadcrumb-separator" style="color: rgba(255, 255, 255, 0.6);">
            <i class="fas fa-chevron-left"></i>
          </li>
          <li class="breadcrumb-item active" style="color: white; font-weight: 600;">
            <i class="fas fa-users" style="margin-left: 0.5rem;"></i>
            إدارة المستخدمين
          </li>
        </ol>
      </nav>

      <!-- Page Title and Actions -->
      <div class="d-flex justify-content-between align-items-center">
        <div class="page-title">
          <h1 style="color: white; font-size: 2.5rem; font-weight: 800; margin: 0; text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);">
            <i class="fas fa-users" style="margin-left: 1rem; color: #ffd700;"></i>
            إدارة المستخدمين
          </h1>
          <p style="color: rgba(255, 255, 255, 0.9); margin: 0.5rem 0 0 0;">إدارة شاملة لجميع المستخدمين في النظام</p>
        </div>
        
        <div class="header-actions" style="display: flex; gap: 1rem;">
          <button 
            class="btn btn-primary" 
            (click)="openCreateModal()"
            style="background: linear-gradient(135deg, #11998e, #38ef7d); border: none; padding: 0.75rem 1.5rem; border-radius: 10px; font-weight: 600; box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);">
            <i class="fas fa-plus" style="margin-left: 0.5rem;"></i>
            إضافة مستخدم جديد
          </button>
          
          <button 
            class="btn btn-outline-light" 
            (click)="exportUsers()"
            style="border: 2px solid rgba(255, 255, 255, 0.3); padding: 0.75rem 1.5rem; border-radius: 10px; font-weight: 600; backdrop-filter: blur(10px);">
            <i class="fas fa-download" style="margin-left: 0.5rem;"></i>
            تصدير البيانات
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Statistics Cards - Full Width -->
  <div class="statistics-section" style="padding: 2rem;">
    <div class="container-fluid">
      <div class="row g-4">
        <div class="col-12">
          <div class="stats-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
            
            <!-- Total Users Card -->
            <div class="stat-card modern-stat-card" style="background: linear-gradient(135deg, #f8fafc, #e2e8f0); border-radius: 16px; padding: 2rem; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border: 1px solid #e5e7eb; transition: transform 0.3s ease;">
              <div class="stat-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);">
                <i class="fas fa-users" style="font-size: 1.5rem; color: white;"></i>
              </div>
              <h4 style="font-size: 2.2rem; font-weight: 700; color: #1e293b; margin: 0.5rem 0;">{{ statistics.totalUsers }}</h4>
              <p style="margin: 0; color: #64748b; font-weight: 500;">إجمالي المستخدمين</p>
            </div>
            
            <!-- Admin Users Card -->
            <div class="stat-card modern-stat-card" style="background: linear-gradient(135deg, #fef7ec, #fed7aa); border-radius: 16px; padding: 2rem; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border: 1px solid #fed7aa; transition: transform 0.3s ease;">
              <div class="stat-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #f59e0b, #f97316); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">
                <i class="fas fa-user-shield" style="font-size: 1.5rem; color: white;"></i>
              </div>
              <h4 style="font-size: 2.2rem; font-weight: 700; color: #1e293b; margin: 0.5rem 0;">{{ statistics.adminUsers }}</h4>
              <p style="margin: 0; color: #64748b; font-weight: 500;">المديرين</p>
            </div>
            
            <!-- Merchant Users Card -->
            <div class="stat-card modern-stat-card" style="background: linear-gradient(135deg, #f0f9ff, #bae6fd); border-radius: 16px; padding: 2rem; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border: 1px solid #bae6fd; transition: transform 0.3s ease;">
              <div class="stat-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #06b6d4, #0891b2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);">
                <i class="fas fa-store" style="font-size: 1.5rem; color: white;"></i>
              </div>
              <h4 style="font-size: 2.2rem; font-weight: 700; color: #1e293b; margin: 0.5rem 0;">{{ statistics.merchantUsers }}</h4>
              <p style="margin: 0; color: #64748b; font-weight: 500;">التجار</p>
            </div>
            
            <!-- Client Users Card -->
            <div class="stat-card modern-stat-card" style="background: linear-gradient(135deg, #f0fdf4, #bbf7d0); border-radius: 16px; padding: 2rem; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border: 1px solid #bbf7d0; transition: transform 0.3s ease;">
              <div class="stat-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                <i class="fas fa-user-friends" style="font-size: 1.5rem; color: white;"></i>
              </div>
              <h4 style="font-size: 2.2rem; font-weight: 700; color: #1e293b; margin: 0.5rem 0;">{{ statistics.clientUsers }}</h4>
              <p style="margin: 0; color: #64748b; font-weight: 500;">العملاء</p>
            </div>
            
            <!-- Shipping Users Card -->
            <div class="stat-card modern-stat-card" style="background: linear-gradient(135deg, #fdf4ff, #e9d5ff); border-radius: 16px; padding: 2rem; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border: 1px solid #e9d5ff; transition: transform 0.3s ease;">
              <div class="stat-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #8b5cf6, #a855f7); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
                <i class="fas fa-truck" style="font-size: 1.5rem; color: white;"></i>
              </div>
              <h4 style="font-size: 2.2rem; font-weight: 700; color: #1e293b; margin: 0.5rem 0;">{{ statistics.shippingUsers }}</h4>
              <p style="margin: 0; color: #64748b; font-weight: 500;">شركات الشحن والسائقين</p>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Search and Filter Section -->
  <div class="search-section" style="padding: 0 2rem 2rem;">
    <div class="container-fluid">
      <div class="search-card premium-search" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05)); backdrop-filter: blur(25px); border-radius: 25px; padding: 2.5rem; border: 2px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden;">
        
        <!-- Background Pattern -->
        <div class="search-pattern" style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 2px, transparent 2px); background-size: 30px 30px; opacity: 0.3; animation: float 6s ease-in-out infinite;"></div>
        
        <form [formGroup]="searchForm" class="elegant-form">
          <div class="row g-4">
            <div class="col-lg-4 col-md-6">
              <label class="form-label premium-label" style="color: white; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                <i class="fas fa-search" style="color: #ffd700;"></i>
                البحث السريع
              </label>
              <div class="input-group premium-input-group" style="position: relative;">
               
                <input 
                  type="text" 
                  class="form-control premium-input" 
                  formControlName="searchTerm"
                  placeholder="ابحث بالاسم أو رقم الهاتف..."
                  style="background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 215, 0, 0.3); color: white; border-radius: 0 15px 15px 0; padding: 1rem 1.5rem; font-weight: 500; backdrop-filter: blur(15px); transition: all 0.3s ease;">
                   <span class="input-group-text premium-input-icon" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1)); border: 2px solid rgba(255, 215, 0, 0.3); color: #ffd700; border-radius: 15px 0 0 15px; backdrop-filter: blur(15px);">
                  <i class="fas fa-search" style="font-size: 1.1rem;"></i>
                </span>
                <div class="input-glow" style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4, #45b7d1); border-radius: 15px; opacity: 0; transition: opacity 0.3s ease; z-index: -1;"></div>
              </div>
            </div>
            
            <div class="col-lg-2 col-md-6">
              <label class="form-label premium-label" style="color: white; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                <i class="fas fa-users-cog" style="color: #ffd700;"></i>
                نوع المستخدم
              </label>
              <select 
                class="form-select premium-select" 
                formControlName="userType"
                (change)="onFilterChange()"
                style="background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 215, 0, 0.3); color: white; border-radius: 15px; padding: 1rem 1.5rem; font-weight: 500; backdrop-filter: blur(15px); transition: all 0.3s ease;">
                <option value="all" style="background: #1f2937; color: white;">جميع الأنواع</option>
                <option [value]="UserTypeEnum.Admin" style="background: #1f2937; color: white;">مدير</option>
                <option [value]="UserTypeEnum.Client" style="background: #1f2937; color: white;">عميل</option>
                <option [value]="UserTypeEnum.Merchant" style="background: #1f2937; color: white;">تاجر</option>
                <option [value]="UserTypeEnum.ShippingCompany" style="background: #1f2937; color: white;">شركة شحن</option>
              </select>
            </div>
            
            <div class="col-lg-2 col-md-6">
              <label class="form-label premium-label" style="color: white; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                <i class="fas fa-toggle-on" style="color: #ffd700;"></i>
                الحالة
              </label>
              <select 
                class="form-select premium-select" 
                formControlName="status"
                (change)="onFilterChange()"
                style="background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 215, 0, 0.3); color: white; border-radius: 15px; padding: 1rem 1.5rem; font-weight: 500; backdrop-filter: blur(15px); transition: all 0.3s ease;">
                <option value="all" style="background: #1f2937; color: white;">جميع الحالات</option>
                <option value="active" style="background: #1f2937; color: white;">نشط</option>
                <option value="inactive" style="background: #1f2937; color: white;">غير نشط</option>
              </select>
            </div>
            
            <div class="col-lg-2 col-md-6">
              <label class="form-label premium-label" style="color: white; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                <i class="fas fa-list-ol" style="color: #ffd700;"></i>
                عدد النتائج
              </label>
              <select 
                class="form-select premium-select" 
                [value]="pageSize"
                (change)="onPageSizeChange($event)"
                style="background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 215, 0, 0.3); color: white; border-radius: 15px; padding: 1rem 1.5rem; font-weight: 500; backdrop-filter: blur(15px); transition: all 0.3s ease;">
                <option value="10" style="background: #1f2937; color: white;">10</option>
                <option value="25" style="background: #1f2937; color: white;">25</option>
                <option value="50" style="background: #1f2937; color: white;">50</option>
                <option value="100" style="background: #1f2937; color: white;">100</option>
              </select>
            </div>
            
            <div class="col-lg-2 col-md-6">
              <label class="form-label premium-label" style="color: white; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                <i class="fas fa-magic" style="color: #ffd700;"></i>
                إجراءات سريعة
              </label>
              <div class="quick-actions" style="display: flex; gap: 0.5rem;">
                <button 
                  type="button" 
                  class="btn btn-outline-light btn-sm quick-action-btn" 
                  (click)="clearFilters()"
                  style="border: 2px solid rgba(255, 255, 255, 0.3); padding: 1rem; border-radius: 12px; backdrop-filter: blur(15px); transition: all 0.3s ease; flex: 1;"
                  title="مسح الفلاتر">
                  <i class="fas fa-eraser"></i>
                </button>
                <button 
                  type="button" 
                  class="btn btn-outline-light btn-sm quick-action-btn" 
                  (click)="refreshData()"
                  style="border: 2px solid rgba(255, 255, 255, 0.3); padding: 1rem; border-radius: 12px; backdrop-filter: blur(15px); transition: all 0.3s ease; flex: 1;"
                  title="تحديث البيانات">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modern Users Table Section -->
  <div class="table-section" style="padding: 0 2rem 2rem;">
    <div class="container-fluid">
      <div class="modern-table-container" style="background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); overflow: hidden; border: 1px solid #e5e7eb;">
        
        <!-- Table Header -->
        <div class="table-header d-flex justify-content-between align-items-center" style="background: #f8fafc; padding: 1.5rem 2rem; border-bottom: 1px solid #e5e7eb;">
          <div class="header-info">
            <h3 style="margin: 0; color: #1e293b; font-weight: 600; font-size: 1.3rem;">
              <i class="fas fa-users" style="margin-left: 0.5rem; color: #6366f1;"></i>
              قائمة المستخدمين
            </h3>
            <p style="margin: 0.25rem 0 0 0; color: #64748b; font-size: 0.9rem;">إجمالي {{ totalCount }} مستخدم</p>
          </div>
          
          <div class="table-actions" style="display: flex; gap: 1rem; align-items: center;">
            <button 
              class="btn btn-outline-primary btn-sm" 
              (click)="refreshData()"
              style="border-radius: 8px; padding: 0.5rem 1rem; border: 1px solid #6366f1; color: #6366f1; background: white;">
              <i class="fas fa-sync-alt" style="margin-left: 0.25rem;"></i>
              تحديث
            </button>
            <button 
              class="btn btn-outline-secondary btn-sm" 
              (click)="exportUsers()"
              style="border-radius: 8px; padding: 0.5rem 1rem; border: 1px solid #6b7280; color: #6b7280; background: white;">
              <i class="fas fa-download" style="margin-left: 0.25rem;"></i>
              تصدير
            </button>
          </div>
        </div>
        
        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container" style="display: flex; justify-content: center; align-items: center; padding: 4rem; background: white;">
          <div class="loading-content" style="text-align: center;">
            <div class="spinner-border" style="color: #6366f1; width: 3rem; height: 3rem; margin-bottom: 1rem;"></div>
            <p style="color: #6b7280; margin: 0;">جاري تحميل البيانات...</p>
          </div>
        </div>

        <!-- Modern Table -->
        <div *ngIf="!loading" class="table-wrapper">
          <table class="table modern-data-table" style="margin: 0; width: 100%;">
            <thead style="background: #f8fafc; border-bottom: 1px solid #e5e7eb;">
              <tr>
                <th style="padding: 1rem 1.5rem; color: #374151; font-weight: 600; font-size: 0.875rem; text-align: right; border-bottom: 1px solid #e5e7eb;">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-id-card" style="color: #6366f1; font-size: 0.875rem;"></i>
                    الاسم الكامل
                  </div>
                </th>
                <th style="padding: 1rem 1.5rem; color: #374151; font-weight: 600; font-size: 0.875rem; text-align: right; border-bottom: 1px solid #e5e7eb;">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-user" style="color: #6366f1; font-size: 0.875rem;"></i>
                    اسم المستخدم
                  </div>
                </th>
                <th style="padding: 1rem 1.5rem; color: #374151; font-weight: 600; font-size: 0.875rem; text-align: right; border-bottom: 1px solid #e5e7eb;">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-phone" style="color: #6366f1; font-size: 0.875rem;"></i>
                    رقم الهاتف
                  </div>
                </th>
                <th style="padding: 1rem 1.5rem; color: #374151; font-weight: 600; font-size: 0.875rem; text-align: right; border-bottom: 1px solid #e5e7eb;">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-users-cog" style="color: #6366f1; font-size: 0.875rem;"></i>
                    نوع المستخدم
                  </div>
                </th>
                <th style="padding: 1rem 1.5rem; color: #374151; font-weight: 600; font-size: 0.875rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                  <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <i class="fas fa-toggle-on" style="color: #6366f1; font-size: 0.875rem;"></i>
                    الحالة
                  </div>
                </th>
                <th style="padding: 1rem 1.5rem; color: #374151; font-weight: 600; font-size: 0.875rem; text-align: center; border-bottom: 1px solid #e5e7eb;">
                  <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <i class="fas fa-cogs" style="color: #6366f1; font-size: 0.875rem;"></i>
                    الإجراءات
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of filteredUsers; trackBy: trackByUserId; let i = index" 
                  style="border-bottom: 1px solid #f1f5f9; transition: background-color 0.2s ease;"
                 >
                
                <!-- Full Name Cell -->
                <td style="padding: 1rem 1.5rem; vertical-align: middle;">
                  <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <div class="user-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #6366f1, #8b5cf6); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                      <img *ngIf="user.photo" [src]="user.photo" [alt]="user.fullName" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                      <i *ngIf="!user.photo" class="fas fa-user" style="color: white; font-size: 1rem;"></i>
                    </div>
                    <div class="user-info">
                      <div style="font-weight: 600; color: #1e293b; font-size: 0.95rem; line-height: 1.4;">{{ user.fullName }}</div>
                      <div style="font-size: 0.8rem; color: #64748b;">ID: #{{ user.id }}</div>
                    </div>
                  </div>
                </td>
                
                <!-- Username Cell -->
                <td style="padding: 1rem 1.5rem; vertical-align: middle;">
                  <div style="font-weight: 500; color: #374151; font-size: 0.9rem;">{{ user.userName }}</div>
                </td>
                
                <!-- Phone Cell -->
                <td style="padding: 1rem 1.5rem; vertical-align: middle;">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; flex-shrink: 0;"></div>
                    <a [href]="'tel:' + user.phoneNumber" style="color: #374151; text-decoration: none; font-size: 0.9rem; font-weight: 500;">
                      {{ user.phoneNumber }}
                    </a>
                  </div>
                </td>
                
                <!-- User Type Cell -->
                <td style="padding: 1rem 1.5rem; vertical-align: middle;">
                  <span class="badge user-type-badge" 
                        [style.background]="getUserTypeColor(user.userType)"
                        style="padding: 0.5rem 0.75rem; border-radius: 12px; font-weight: 500; font-size: 0.8rem; color: white; display: inline-flex; align-items: center; gap: 0.25rem;">
                    <i [class]="getUserTypeIcon(user.userType)" style="font-size: 0.75rem;"></i>
                    {{ getUserTypeDisplayName(user.userType) }}
                  </span>
                </td>
                
                <!-- Status Cell -->
                <td style="padding: 1rem 1.5rem; vertical-align: middle; text-align: center;">
                  <span class="badge status-badge" 
                        [style.background]="user.isActive ? '#10b981' : '#ef4444'"
                        [style.color]="'white'"
                        style="padding: 0.5rem 0.75rem; border-radius: 12px; font-weight: 500; font-size: 0.8rem; display: inline-flex; align-items: center; gap: 0.25rem;">
                    <div [style.background]="user.isActive ? '#dcfce7' : '#fee2e2'" 
                         style="width: 6px; height: 6px; border-radius: 50%;"></div>
                    {{ getStatusText(user.isActive) }}
                  </span>
                </td>
                
                <!-- Actions Cell -->
                <td style="padding: 1rem 1.5rem; vertical-align: middle; text-align: center;">
                  <div class="action-buttons" style="display: flex; gap: 0.5rem; justify-content: center;">
                    <button 
                      class="btn btn-sm" 
                      (click)="openEditModal(user)"
                      style="background: #eff6ff; color: #3b82f6; border: 1px solid #dbeafe; border-radius: 8px; padding: 0.5rem 0.75rem; font-size: 0.8rem; transition: all 0.2s ease;"
                      title="تعديل">
                      <i class="fas fa-edit"></i>
                    </button>
                    
                    <button 
                      class="btn btn-sm" 
                      (click)="toggleUserStatus(user)"
                      [style.background]="user.isActive ? '#fee2e2' : '#dcfce7'"
                      [style.color]="user.isActive ? '#ef4444' : '#16a34a'"
                      [style.border]="user.isActive ? '1px solid #fecaca' : '1px solid #bbf7d0'"
                      style="border-radius: 8px; padding: 0.5rem 0.75rem; font-size: 0.8rem; transition: all 0.2s ease;"
                      [title]="user.isActive ? 'إلغاء تفعيل المستخدم' : 'تفعيل المستخدم'">
                      <i [class]="user.isActive ? 'fas fa-toggle-off' : 'fas fa-toggle-on'"></i>
                    </button>
                    
                    <button 
                      class="btn btn-sm" 
                      (click)="confirmDelete(user)"
                      style="background: #fef2f2; color: #ef4444; border: 1px solid #fecaca; border-radius: 8px; padding: 0.5rem 0.75rem; font-size: 0.8rem; transition: all 0.2s ease;"
                      title="حذف">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
              
              <!-- Empty State -->
              <tr *ngIf="filteredUsers.length === 0 && !loading">
                <td colspan="6" style="padding: 3rem; text-align: center; background: #f8fafc;">
                  <div class="empty-state">
                    <i class="fas fa-users" style="font-size: 3rem; color: #d1d5db; margin-bottom: 1rem;"></i>
                    <h5 style="color: #6b7280; margin-bottom: 0.5rem;">لا توجد نتائج</h5>
                    <p style="color: #9ca3af; margin: 0; font-size: 0.9rem;">لم يتم العثور على أي مستخدمين بناءً على المعايير المحددة</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Modern Pagination -->
        <div *ngIf="!loading && totalPages > 1" class="pagination-container" style="padding: 1.5rem 2rem; border-top: 1px solid #e5e7eb; background: #f8fafc; display: flex; justify-content: between; align-items: center;">
          <div class="pagination-info" style="color: #64748b; font-size: 0.9rem;">
            عرض {{ (currentPage - 1) * pageSize + 1 }} إلى {{ Math.min(currentPage * pageSize, totalCount) }} من {{ totalCount }} نتيجة
          </div>
          
          <nav aria-label="صفحات النتائج">
            <div class="pagination-controls" style="display: flex; gap: 0.5rem; align-items: center;">
              <button 
                class="pagination-btn" 
                (click)="onPageChange(currentPage - 1)" 
                [disabled]="currentPage === 1"
                style="background: white; border: 1px solid #d1d5db; color: #374151; border-radius: 8px; padding: 0.5rem 0.75rem; font-size: 0.9rem; transition: all 0.2s ease; cursor: pointer;"
                [style.opacity]="currentPage === 1 ? '0.5' : '1'"
                [style.cursor]="currentPage === 1 ? 'not-allowed' : 'pointer'">
                <i class="fas fa-chevron-right"></i>
              </button>
              
              <span *ngFor="let page of getPaginationPages()" 
                    class="pagination-page"
                    [class.active]="page === currentPage">
                <button 
                  (click)="onPageChange(page)"
                  [style.background]="page === currentPage ? '#6366f1' : 'white'"
                  [style.color]="page === currentPage ? 'white' : '#374151'"
                  [style.border]="page === currentPage ? '1px solid #6366f1' : '1px solid #d1d5db'"
                  style="border-radius: 8px; padding: 0.5rem 0.75rem; font-size: 0.9rem; font-weight: 500; min-width: 40px; transition: all 0.2s ease; cursor: pointer;">
                  {{ page }}
                </button>
              </span>
              
              <button 
                class="pagination-btn" 
                (click)="onPageChange(currentPage + 1)"
                [disabled]="currentPage === totalPages"
                style="background: white; border: 1px solid #d1d5db; color: #374151; border-radius: 8px; padding: 0.5rem 0.75rem; font-size: 0.9rem; transition: all 0.2s ease; cursor: pointer;"
                [style.opacity]="currentPage === totalPages ? '0.5' : '1'"
                [style.cursor]="currentPage === totalPages ? 'not-allowed' : 'pointer'">
                <i class="fas fa-chevron-left"></i>
              </button>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ✨ Enhanced User Modal - إضافة/تعديل مستخدم ✨ -->
<!-- Modal Backdrop with Blur Effect - Outside modal container -->
<div class="modal-backdrop-custom" *ngIf="isModalOpen" (click)="closeModal()"></div>

<div class="modal fade" id="userModal" tabindex="-1" [class.show]="isModalOpen" [style.display]="isModalOpen ? 'block' : 'none'">
  <div class="modal-dialog modal-xl">
    <div class="modern-modal-content">
      
      <!-- 🎨 Decorative Header with Gradient -->
      <div class="modal-header-enhanced">
        <div class="modal-title">
          <!-- Dynamic Icon with Animation -->
          <div class="header-icon">
            <i [class]="modalMode === 'create' ? 'fas fa-user-plus' : 'fas fa-user-edit'"></i>
          </div>
          
          <div>
            <div>
              {{ modalMode === 'create' ? '✨ إضافة مستخدم جديد' : '🔧 تعديل بيانات المستخدم' }}
            </div>
            <div>
              {{ modalMode === 'create' ? 'أضف مستخدم جديد للنظام' : 'قم بتحديث بيانات المستخدم' }}
            </div>
          </div>
        </div>
        
        <button type="button" 
                class="btn-close-enhanced" 
                (click)="closeModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- 📝 Enhanced Form Body -->
      <div class="modal-body-enhanced">
        <form [formGroup]="userForm">
          <div class="row g-3">
            
            <!-- Row 1: Username, Full Name, Email -->
            <div class="col-md-4">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon username-icon">
                    <i class="fas fa-user"></i>
                  </div>
                  اسم المستخدم *
                </label>
                <div class="input-with-icon">
                  <input 
                    type="text" 
                    class="form-control enhanced-input username-input" 
                    formControlName="userName"
                    [class.is-invalid]="isFieldInvalid('userName')"
                    placeholder="اسم المستخدم">
                  <div class="input-icon-left">
                    <i class="fas fa-at"></i>
                  </div>
                </div>
                <div *ngIf="isFieldInvalid('userName')" class="invalid-feedback">
                  {{ getFieldError('userName') }}
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon fullname-icon">
                    <i class="fas fa-id-card"></i>
                  </div>
                  الاسم الكامل *
                </label>
                <div class="input-with-icon">
                  <input 
                    type="text" 
                    class="form-control enhanced-input fullname-input" 
                    formControlName="fullName"
                    [class.is-invalid]="isFieldInvalid('fullName')"
                    placeholder="الاسم الكامل">
                  <div class="input-icon-left">
                    <i class="fas fa-signature"></i>
                  </div>
                </div>
                <div *ngIf="isFieldInvalid('fullName')" class="invalid-feedback">
                  {{ getFieldError('fullName') }}
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon email-icon">
                    <i class="fas fa-envelope"></i>
                  </div>
                  البريد الإلكتروني *
                </label>
                <div class="input-with-icon">
                  <input 
                    type="email" 
                    class="form-control enhanced-input email-input" 
                    formControlName="email"
                    [class.is-invalid]="isFieldInvalid('email')"
                    placeholder="البريد الإلكتروني">
                  <div class="input-icon-left">
                    <i class="fas fa-mail-bulk"></i>
                  </div>
                </div>
                <div *ngIf="isFieldInvalid('email')" class="invalid-feedback">
                  {{ getFieldError('email') }}
                </div>
              </div>
            </div>
            
            <!-- Row 2: Phone, Password (if create), National ID -->
            <div class="col-md-4">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon phone-icon">
                    <i class="fas fa-phone"></i>
                  </div>
                  رقم الهاتف *
                </label>
                <div class="input-with-icon">
                  <input 
                    type="tel" 
                    class="form-control enhanced-input phone-input" 
                    formControlName="phoneNumber"
                    [class.is-invalid]="isFieldInvalid('phoneNumber')"
                    placeholder="رقم الهاتف">
                  <div class="input-icon-left">
                    <i class="fas fa-mobile-alt"></i>
                  </div>
                </div>
                <div *ngIf="isFieldInvalid('phoneNumber')" class="invalid-feedback">
                  {{ getFieldError('phoneNumber') }}
                </div>
              </div>
            </div>
            
            <div class="col-md-4" *ngIf="modalMode === 'create'">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon password-icon">
                    <i class="fas fa-key"></i>
                  </div>
                  كلمة المرور *
                </label>
                <div class="input-with-icon">
                  <input 
                    type="password" 
                    class="form-control enhanced-input password-input" 
                    formControlName="password"
                    [class.is-invalid]="isFieldInvalid('password')"
                    placeholder="كلمة المرور">
                  <div class="input-icon-left">
                    <i class="fas fa-lock"></i>
                  </div>
                </div>
                <div *ngIf="isFieldInvalid('password')" class="invalid-feedback">
                  {{ getFieldError('password') }}
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon national-id-icon">
                    <i class="fas fa-id-badge"></i>
                  </div>
                  الهوية الوطنية
                </label>
                <div class="input-with-icon">
                  <input 
                    type="text" 
                    class="form-control enhanced-input national-id-input" 
                    formControlName="nationalId"
                    placeholder="رقم الهوية">
                  <div class="input-icon-left">
                    <i class="fas fa-fingerprint"></i>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Row 3: User Type, Status Checkbox, Address -->
            <div class="col-md-4">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon user-type-icon">
                    <i class="fas fa-users-cog"></i>
                  </div>
                  نوع المستخدم *
                </label>
                <div class="select-with-icon">
                  <select 
                    class="form-select enhanced-select" 
                    formControlName="userType"
                    [class.is-invalid]="isFieldInvalid('userType')">
                    <option [value]="UserTypeEnum.Client">👥 عميل</option>
                    <option [value]="UserTypeEnum.Merchant">🏪 تاجر</option>
                    <option [value]="UserTypeEnum.Admin">🛡️ مدير</option>
                    <option [value]="UserTypeEnum.ShippingCompany">🚚 شحن</option>
                  </select>
                  <!-- <div class="input-icon-left">
                    <i class="fas fa-layer-group"></i>
                  </div> -->
                </div>
                <div *ngIf="isFieldInvalid('userType')" class="invalid-feedback">
                  {{ getFieldError('userType') }}
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon status-icon">
                    <i class="fas fa-toggle-on"></i>
                  </div>
                  حالة المستخدم
                </label>
                <div class="custom-checkbox-wrapper">
                  <div [style.opacity]="userForm.get('isActive')?.value ? '1' : '0'"></div>
                  
                  <div>
                    <!-- <div class="checkbox-icon">
                      <i [class]="userForm.get('isActive')?.value ? 'fas fa-check' : 'fas fa-times'"></i>
                    </div> -->
                    
                    <div>
                      <label class="form-check-label" for="isActiveCheck">
                        {{ userForm.get('isActive')?.value ? 'مستخدم نشط ✅' : 'مستخدم غير نشط ❌' }}
                      </label>
                    </div>
                  </div>
                  
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    formControlName="isActive"
                    id="isActiveCheck">
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="enhanced-form-group">
                <label class="enhanced-form-label">
                  <div class="field-icon address-icon">
                    <i class="fas fa-map-marker-alt"></i>
                  </div>
                  العنوان
                </label>
                <div class="input-with-icon">
                  <input 
                    type="text" 
                    class="form-control enhanced-input address-input" 
                    formControlName="address"
                    placeholder="العنوان">
                  <div class="input-icon-left">
                    <i class="fas fa-home"></i>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Address Field -->
          </div>
        </form>
      </div>
      
      <!-- 🎯 Enhanced Modal Footer -->
      <div class="modal-footer-enhanced">
        <!-- Cancel Button -->
        <button 
          type="button" 
          class="btn-cancel-enhanced" 
          (click)="closeModal()">
          <i class="fas fa-times"></i>
          إلغاء
        </button>
        
        <!-- Save Button -->
        <button 
          type="button" 
          class="btn-save-enhanced" 
          (click)="saveUser()"
          [disabled]="!userForm.valid"
          [style.opacity]="userForm.valid ? '1' : '0.6'"
          [style.cursor]="userForm.valid ? 'pointer' : 'not-allowed'">
          <!-- Loading Spinner (Hidden by default) -->
          <div class="save-spinner"></div>
          
          <!-- Save Icon -->
          <i class="fas fa-save save-icon"></i>
          
          <!-- Button Text -->
          <span class="save-text">
            {{ modalMode === 'create' ? '✨ إضافة المستخدم' : '💾 حفظ التغييرات' }}
          </span>
          
          <!-- Success Icon (Hidden by default) -->
          <i class="fas fa-check save-success"></i>
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-exclamation-triangle"></i>
          تأكيد الحذف
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      
      <div class="modal-body">
        <p>هل أنت متأكد من رغبتك في حذف المستخدم؟</p>
        <div *ngIf="userToDelete" class="user-info">
          <strong>{{ userToDelete.fullName }}</strong>
          <br>
          <small>{{ userToDelete.email }}</small>
        </div>
        <p>
          <i class="fas fa-warning"></i>
          تحذير: هذا الإجراء لا يمكن التراجع عنه
        </p>
      </div>
      
      <div class="modal-footer">
        <button 
          type="button" 
          class="btn btn-secondary" 
          data-bs-dismiss="modal"
          (click)="cancelDelete()">
          إلغاء
        </button>
        <button 
          type="button" 
          class="btn btn-danger" 
          (click)="deleteUser()"
          data-bs-dismiss="modal">
          <i class="fas fa-trash"></i>
          حذف
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Swiper -->
<div *ngIf="userToDelete" class="delete-confirmation-overlay">
  <div class="delete-swiper-container">
    
    <!-- Swiper Wrapper -->
    <div class="swiper delete-confirmation-swiper">
      <div class="swiper-wrapper">
        
        <!-- Slide 1: Warning -->
        <div class="swiper-slide">
          <div class="warning-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <h3>تحذير!</h3>
          <p>أنت على وشك حذف مستخدم من النظام</p>
          <div class="swipe-indicator">
            <i class="fas fa-arrow-left"></i>
            <span>اسحب للمتابعة</span>
          </div>
        </div>
        
        <!-- Slide 2: User Info -->
        <div class="swiper-slide">
          <div class="user-details-card">
            <div class="user-avatar-large">
              <img *ngIf="userToDelete.photo" [src]="userToDelete.photo" [alt]="userToDelete.fullName">
              <i *ngIf="!userToDelete.photo" class="fas fa-user"></i>
            </div>
            
            <h4>{{ userToDelete.fullName }}</h4>
            <p>{{ userToDelete.email }}</p>
            
            <div class="user-type-badge-large">
              <i [class]="getUserTypeIcon(userToDelete.userType)"></i>
              {{ getUserTypeDisplayName(userToDelete.userType) }}
            </div>
            
            <div class="swipe-indicator">
              <i class="fas fa-arrow-left"></i>
              <span>اسحب للتأكيد النهائي</span>
            </div>
          </div>
        </div>
        
        <!-- Slide 3: Final Confirmation -->
        <div class="swiper-slide">
          <div class="final-warning">
            <div class="danger-icon">
              <i class="fas fa-trash-alt"></i>
            </div>
            
            <h3>تأكيد الحذف النهائي</h3>
            <p>هذا الإجراء <strong>لا يمكن التراجع عنه</strong></p>
            <p>سيتم حذف جميع بيانات المستخدم نهائياً</p>
          </div>
          
          <!-- Action Buttons -->
          <div class="confirmation-actions">
            <button 
              class="btn btn-outline-secondary" 
              (click)="cancelDelete()">
              <i class="fas fa-times"></i>
              إلغاء
            </button>
            
            <button 
              class="btn btn-danger" 
              (click)="deleteUser()">
              <i class="fas fa-trash"></i>
              حذف نهائي
            </button>
          </div>
        </div>
        
      </div>
      
      <!-- Swiper Pagination -->
      <div class="swiper-pagination"></div>
      
      <!-- Swiper Navigation -->
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
    </div>
    
    <!-- Close Button -->
    <button 
      class="close-swiper-btn" 
      (click)="cancelDelete()">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>
