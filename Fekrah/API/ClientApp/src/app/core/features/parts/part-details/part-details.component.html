<section class="container py-5">
  <div class="row d-flex align-items-stretch">
    <!-- ุนููุฏ ุงูุตูุฑ -->
    <div class="col-lg-5 d-flex">
      <div class="border rounded shadow-sm p-3 bg-white position-relative w-100 d-flex flex-column">
        <div class="magnifier-container mb-3">
          <img [src]="selectedImage" id="mainImage" class="img-fluid w-100 main-image border" (click)="toggleZoom()">
          <div id="lens" class="magnifier-lens"></div>
        </div>
        <div
          class="position-absolute top-50 start-50 translate-middle bg-dark text-white px-3 py-2 rounded opacity-0 group-hover-opacity">
          ุงุถุบุท ููุชูุจูุฑ
        </div>
        <div class="d-flex gap-2 flex-wrap justify-content-center mt-auto">
          <img *ngFor="let thumb of part.thumbnails" [src]="thumb" class="img-thumbnail"
            style="width: 60px; height: 60px; cursor: pointer" [class.border-primary]="thumb === selectedImage"
            (click)="openImageInModal(thumb)">
        </div>
        <div class="text-center mt-3">
          <button class="btn btn-outline-dark btn-sm" data-bs-toggle="modal" data-bs-target="#zoomModal">
            <i class="fas fa-search-plus"></i> ุชูุจูุฑ ุงูุตูุฑุฉ
          </button>
        </div>
      </div>
    </div>

    <!-- ุนููุฏ ุงูุชูุงุตูู -->
    <div class="col-lg-7 d-flex">
      <div class="bg-white p-4 rounded shadow-sm w-100 d-flex flex-column justify-content-between">

        <div>
          <!-- ุงุณู ุงููุทุนุฉ -->
          <div class="mb-3">
            <h1 class="product-title text-dark fw-bold mb-2" style="font-size: 1.8rem; line-height: 1.4;">
              {{ part.name }}
            </h1>
          </div>

          <!-- ุดุงุฑุงุช ุงูููุชุฌ -->
          <div class="mb-3 d-flex flex-wrap gap-2">
            <span class="badge bg-success rounded-pill fw-medium px-3 py-1" *ngIf="part.condition === 'ุฌุฏูุฏ'">
              ุฌุฏูุฏ
            </span>
            <span class="badge bg-danger rounded-pill fw-medium px-3 py-1" *ngIf="part.onSale">
              ุฎุตู
            </span>
            <span class="badge bg-warning text-dark rounded-pill fw-medium px-3 py-1">
              ุงูุฃูุซุฑ ูุจูุนูุง
            </span>
          </div>

          <!-- ูุตู ุงูููุชุฌ -->
          <div class="card bg-white border rounded shadow-sm mb-4">
            <div class="card-body">
              <p class="mb-0" style="font-size: 1rem; line-height: 1.8; color: #555;">
                {{ part.description }}
              </p>
            </div>
          </div>

          <!-- ูุนูููุงุช ุงูุชุงุฌุฑ -->
          <div class="bg-light border rounded p-3 mb-4">
            <div class="text-muted small mb-1">ูุจุงุน ุนู ุทุฑูู</div>
            <a [routerLink]="['/seller', part.seller.id]" class="text-decoration-none fw-bold text-primary fs-5">
              {{ part.seller.name }}
            </a>
            <div class="text-muted mt-1 small">
              ููุซูู ุจู โ ุฎุฏูุฉ ููุชุงุฒุฉ ูุชููููุงุช ุนุงููุฉ
            </div>
          </div>

          <!-- ุงูุณุนุฑ ูุงูุฎุตู -->
          <!-- ุจุฏูู ุฎุตู -->
          <div *ngIf="!part.onSale"
            class="discount-card bg-white border border-primary rounded p-3 mb-3 d-flex flex-column align-items-start shadow-sm">
            <span class="text-muted small mb-1">ุงูุณุนุฑ</span>
            <div class="d-flex align-items-baseline gap-2">
              <span class="text-primary fw-bold fs-3">{{ part.price | number }} ุฌ.ู</span>
            </div>
            <small class="text-muted mt-2 opacity-75 fs-6">โ ุงูุณุนุฑ ุดุงูู ุงูุถุฑูุจุฉ</small>
          </div>

          <!-- ูุน ุฎุตู -->
          <div *ngIf="part.onSale"
            class="special-offer-banner bg-warning text-dark p-3 rounded mb-3 d-flex justify-content-between align-items-center shadow-sm">
            <div class="d-flex flex-column">
              <strong class="fs-5">๐ฅ ุณุนุฑ ุฎุงุต ููุชุฑุฉ ูุญุฏูุฏุฉ</strong>
              <small class="text-dark">ูุง ุชููุช ุงููุฑุตุฉ! ุงูุนุฑุถ ุณุงุฑู ุญุชู ููุงุฏ ุงููููุฉ.</small>
            </div>
            <div class="text-end">
              <span class="text-danger fw-bold fs-4">{{ part.price | number }} ุฌ.ู</span>
              <span class="text-muted text-decoration-line-through fs-6 ms-2">
                {{ part.originalPrice | number }} ุฌ.ู
              </span>
              <span class="badge bg-danger ms-2">-{{ calculateDiscount() }}%</span>
            </div>
          </div>
        </div>

        <!-- ุงูุฃุฒุฑุงุฑ -->
        <div class="d-flex flex-column flex-md-row gap-3 mt-3">
          <button class="btn btn-warning text-dark fw-bold flex-fill" (click)="addToCart(); showToast = true"
            style="min-height: 48px;">
            <i class="fas fa-cart-plus me-1"></i> ุฃุถู ุฅูู ุงูุณูุฉ
          </button>
          <button class="btn btn-outline-success fw-semibold flex-fill" (click)="contactViaWhatsApp()"
            style="min-height: 48px;">
            <i class="fab fa-whatsapp me-1"></i> ุชูุงุตู ุนุจุฑ ูุงุชุณุงุจ
          </button>
          <button class="btn btn-outline-primary flex-fill" data-bs-toggle="modal" data-bs-target="#ratingModal"
            style="min-height: 48px;">
            <i class="fas fa-star me-1"></i> ุชูููู
          </button>
        </div>
      </div>
    </div>

  </div>



  <!-- ุชูุงุตูู ุฅุถุงููุฉ -->
  <!-- ุตู ูุชุณุงูู ุงูุฃุนูุฏุฉ -->
  <div class="row d-flex align-items-stretch mt-5" style="min-height: 100%;">

    <!-- ุนููุฏ ุชูุงุตูู ุงูููุชุฌ -->
    <div class="col-lg-8 d-flex">
      <div
        class="product-details-card bg-white border rounded shadow-sm p-4 w-100 h-100 overflow-auto animate__animated animate__fadeInUp">

        <!-- ุงูุนููุงู -->
        <h5 class="fw-bold mb-4 border-bottom pb-2">
          <i class="fas fa-info-circle text-primary me-2"></i> ุชูุงุตูู ุงูููุชุฌ
        </h5>

        <!-- ูุตู ุงูููุชุฌ -->
        <div class="mb-4">
          <p class="text-muted" style="font-size: 1rem; line-height: 1.8;">
            {{ part.description }}
          </p>
        </div>

        <!-- ุงูุนุฑูุถ ุงููุชุงุญุฉ -->
        <div *ngIf="part.offers.length > 0">
          <h6 class="fw-semibold text-success mb-3">
            <i class="fas fa-tags me-1"></i> ุงูุนุฑูุถ ุงููุชุงุญุฉ
          </h6>
          <ul class="list-unstyled ps-2">
            <li *ngFor="let offer of part.offers; let i = index" class="mb-3 d-flex align-items-start">
              <i class="fas fa-check-circle text-success me-2 mt-1"></i>
              <span class="text-dark" style="line-height: 1.6;">
                {{ offer }}
                <span *ngIf="i === 0" class="badge bg-danger text-white ms-2">๐ฅ ุงูุฃููู</span>
              </span>
            </li>
          </ul>
        </div>

        <!-- ูุง ุชูุฌุฏ ุนุฑูุถ -->
        <div *ngIf="!part.offers || part.offers.length === 0" class="text-muted mt-3">
          <i class="fas fa-info-circle me-1"></i> ูุง ุชูุฌุฏ ุนุฑูุถ ุญุงููุงู ุนูู ูุฐุง ุงูููุชุฌ.
        </div>

      </div>
    </div>


    <div class="col-lg-4 d-flex">
      <div class="bg-white border rounded shadow-sm p-4 w-100 review-container d-flex flex-column"
        style="min-height: 0;">
        <!-- ุงูุนููุงู ูุนุฏุฏ ุงูุชููููุงุช -->
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h5 class="fw-bold mb-0">
            <i class="fas fa-comments text-primary me-2"></i> ุชููููุงุช ุงูุนููุงุก
          </h5>
          <span class="badge bg-primary text-white rounded-pill px-3">
            {{ part.comments.length }} ุชูููู
          </span>
        </div>

        <!-- ูุฑุจุน ุงูุชููููุงุช ูุน Scroll ุฏุงุฎูู -->
        <div #reviewsContainer class="review-scroll-container flex-grow-1" style="max-height: 400px; overflow-y: auto;">
          <div class="reviews-fade-in">
            <div *ngFor="let comment of part.comments" class="review-card bg-light rounded shadow-sm mb-3 p-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <strong class="text-dark">{{ comment.user }}</strong>
                <small class="text-muted">{{ comment.date | date:'mediumDate' }}</small>
              </div>
              <div class="mb-2">
                <ng-container *ngFor="let star of [1,2,3,4,5]">
                  <i class="fa-star" [class.fas]="star <= comment.rating" [class.far]="star > comment.rating"
                    [ngClass]="{'text-warning': star <= comment.rating, 'text-muted': star > comment.rating}">
                  </i>
                </ng-container>
              </div>
              <p class="text-dark mb-0">
                {{ comment.text }}
              </p>
            </div>
            <div *ngIf="part.comments.length === 0" class="no-reviews-message text-center py-4">
              <i class="fas fa-info-circle d-block fs-1 text-muted mx-auto" style="width: 60px;"></i>
              <p class="mb-0">ูุง ุชูุฌุฏ ุชููููุงุช ุญุชู ุงูุขู</p>
            </div>
          </div>
        </div>

        <!-- ุฃุฒุฑุงุฑ ุงูุชูุฑูุฑ ูุฃุนูู/ุฃุณูู (ููุฌูุฏุฉ ูู ูุจู) -->
        <div *ngIf="part.comments.length > 3" class="scroll-controls mt-2">
          <button class="scroll-control-btn" (click)="scrollToTopReviews()">
            <i class="fas fa-chevron-up"></i>
          </button>
          <button class="scroll-control-btn" (click)="scrollToBottomReviews()">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>

        <!-- ุฒุฑ ุงูุฅุถุงูุฉ -->
        <div class="mt-3 pt-3 border-top">
          <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#ratingModal">
            <i class="fas fa-plus-circle me-1"></i> ุฃุถู ุชููููู
          </button>
        </div>
      </div>
    </div>






  </div>


  <!-- Toast -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div *ngIf="showToast" class="toast show text-bg-success border-0 animate__animated animate__fadeInUp" role="alert">
      <div class="d-flex">
        <div class="toast-body">โ ุชูุช ุฅุถุงูุฉ ุงูููุชุฌ ุฅูู ุงูุณูุฉ</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="showToast = false"></button>
      </div>
    </div>
  </div>

  <!-- Modal: ุชูุจูุฑ ุงูุตูุฑุฉ -->
  <div class="modal fade" id="zoomModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-body p-0">
          <img [src]="selectedImage" class="img-fluid w-100 rounded" alt="ุชูุจูุฑ ุงูุตูุฑุฉ">
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: ุงูุชูููู -->
  <div class="modal fade" id="ratingModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ุฃุถู ุชููููู</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <i class="fa-star" *ngFor="let star of [1,2,3,4,5]" [class.fas]="star <= newRating"
              [class.far]="star > newRating" class="me-1 text-warning" style="cursor: pointer"
              (click)="setRating(star)"></i>
          </div>
          <textarea [(ngModel)]="newComment" class="form-control" placeholder="ุฃุฏุฎู ุฑุฃูู..." rows="3"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅุบูุงู</button>
          <button type="button" class="btn btn-primary" (click)="submitComment()" data-bs-dismiss="modal">ุฅุฑุณุงู</button>
        </div>
      </div>
    </div>
  </div>
</section>
