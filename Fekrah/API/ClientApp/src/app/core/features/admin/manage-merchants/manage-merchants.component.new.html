<!-- ๐จ ุชุตููู ุนุตุฑู ูุฅุฏุงุฑุฉ ุงูุชุฌุงุฑ -->
<div class="modern-merchants-dashboard">
  
  <!-- ๐ Header ุงูุฑุฆูุณู -->
  <div class="hero-header">
    <div class="hero-background">
      <div class="hero-pattern"></div>
      <div class="hero-overlay"></div>
    </div>
    
    <div class="hero-content">
      <div class="hero-info">
        <div class="hero-icon">
          <i class="fas fa-store-alt"></i>
        </div>
        <div class="hero-text">
          <h1 class="hero-title">
            <span class="title-main">ููุญุฉ ุฅุฏุงุฑุฉ ุงูุชุฌุงุฑ</span>
            <span class="title-accent">ุงููุชูุฏูุฉ</span>
          </h1>
          <p class="hero-description">
            ุฅุฏุงุฑุฉ ุดุงููุฉ ููุชุทูุฑุฉ ูุฌููุน ุงูุชุฌุงุฑ ุงููุณุฌููู ูู ุงูููุตุฉ ูุน ุฅุญุตุงุฆูุงุช ููุตูุฉ
          </p>
          <div class="hero-stats-mini">
            <span class="mini-stat">
              <i class="fas fa-chart-line"></i>
              {{ merchants.length }} ุชุงุฌุฑ
            </span>
            <span class="mini-stat">
              <i class="fas fa-thumbs-up"></i>
              {{ getActiveCount() }} ูุดุท
            </span>
            <span class="mini-stat">
              <i class="fas fa-star"></i>
              {{ getAverageRating() }}
            </span>
          </div>
        </div>
      </div>
      
      <div class="hero-actions">
        <button class="btn-modern primary" (click)="addNewMerchant()">
          <i class="fas fa-plus"></i>
          <span>ุฅุถุงูุฉ ุชุงุฌุฑ ุฌุฏูุฏ</span>
          <div class="btn-shine"></div>
        </button>
        <button class="btn-modern secondary" (click)="exportData()">
          <i class="fas fa-download"></i>
          <span>ุชุตุฏูุฑ ุงูุจูุงูุงุช</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ๐ ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช ุงููุชูุฏูุฉ -->
  <div class="stats-dashboard">
    <div class="stats-grid-modern">
      
      <!-- ุฅุฌูุงูู ุงูุชุฌุงุฑ -->
      <div class="stat-card-modern total" [class.animate-in]="!isLoading">
        <div class="stat-header">
          <div class="stat-icon-wrapper">
            <i class="fas fa-users"></i>
            <div class="icon-pulse"></div>
          </div>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            <span>+12%</span>
          </div>
        </div>
        <div class="stat-body">
          <h3 class="stat-number">{{ merchants.length }}</h3>
          <p class="stat-label">ุฅุฌูุงูู ุงูุชุฌุงุฑ</p>
          <div class="stat-progress">
            <div class="progress-bar" [style.width.%]="100"></div>
          </div>
        </div>
        <div class="stat-footer">
          <span class="stat-detail">ููุฐ ุงูุดูุฑ ุงููุงุถู</span>
        </div>
      </div>

      <!-- ุงูุชุฌุงุฑ ุงููุดุทูู -->
      <div class="stat-card-modern active" [class.animate-in]="!isLoading">
        <div class="stat-header">
          <div class="stat-icon-wrapper">
            <i class="fas fa-check-circle"></i>
            <div class="icon-pulse"></div>
          </div>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            <span>+8%</span>
          </div>
        </div>
        <div class="stat-body">
          <h3 class="stat-number">{{ getActiveCount() }}</h3>
          <p class="stat-label">ุงูุชุฌุงุฑ ุงููุดุทูู</p>
          <div class="stat-progress">
            <div class="progress-bar" [style.width.%]="(getActiveCount() / merchants.length) * 100"></div>
          </div>
        </div>
        <div class="stat-footer">
          <span class="stat-detail">{{ ((getActiveCount() / merchants.length) * 100).toFixed(1) }}% ูู ุงูุฅุฌูุงูู</span>
        </div>
      </div>

      <!-- ูู ุงูุงูุชุธุงุฑ -->
      <div class="stat-card-modern pending" [class.animate-in]="!isLoading">
        <div class="stat-header">
          <div class="stat-icon-wrapper">
            <i class="fas fa-clock"></i>
            <div class="icon-pulse"></div>
          </div>
          <div class="stat-trend neutral">
            <i class="fas fa-minus"></i>
            <span>0%</span>
          </div>
        </div>
        <div class="stat-body">
          <h3 class="stat-number">{{ getPendingCount() }}</h3>
          <p class="stat-label">ูู ุงูุงูุชุธุงุฑ</p>
          <div class="stat-progress">
            <div class="progress-bar" [style.width.%]="(getPendingCount() / merchants.length) * 100"></div>
          </div>
        </div>
        <div class="stat-footer">
          <span class="stat-detail">ูุญุชุงุฌูู ูุฑุงุฌุนุฉ</span>
        </div>
      </div>

      <!-- ูุชูุณุท ุงูุชูููู -->
      <div class="stat-card-modern rating" [class.animate-in]="!isLoading">
        <div class="stat-header">
          <div class="stat-icon-wrapper">
            <i class="fas fa-star"></i>
            <div class="icon-pulse"></div>
          </div>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            <span>+0.3</span>
          </div>
        </div>
        <div class="stat-body">
          <h3 class="stat-number">{{ getAverageRating() }}</h3>
          <p class="stat-label">ูุชูุณุท ุงูุชูููู</p>
          <div class="stat-stars">
            <i class="fas fa-star" *ngFor="let star of [1,2,3,4,5]" 
               [class.filled]="star <= +getAverageRating()"></i>
          </div>
        </div>
        <div class="stat-footer">
          <span class="stat-detail">ูู ุฃุตู 5 ูุฌูู</span>
        </div>
      </div>

    </div>
  </div>

  <!-- ๐ ุดุฑูุท ุงูุจุญุซ ูุงูููุงุชุฑ ุงููุชุทูุฑุฉ -->
  <div class="search-filter-panel">
    <div class="search-section">
      <div class="search-box-modern">
        <div class="search-icon">
          <i class="fas fa-search"></i>
        </div>
        <input 
          type="text" 
          class="search-input-modern" 
          placeholder="ุงูุจุญุซ ูู ุงูุชุฌุงุฑ... (ุงุณู ุงููุชุฌุฑุ ุงูุจุฑูุฏุ ุงููุงุชู)"
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()">
        <button class="search-clear" *ngIf="searchTerm" (click)="searchTerm=''; onSearchChange()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="quick-filters">
        <button class="filter-chip" 
                [class.active]="selectedStatus === 'all'"
                (click)="selectedStatus = 'all'; onStatusChange()">
          <i class="fas fa-list"></i>
          ุงููู ({{ merchants.length }})
        </button>
        <button class="filter-chip" 
                [class.active]="selectedStatus === 'active'"
                (click)="selectedStatus = 'active'; onStatusChange()">
          <i class="fas fa-check"></i>
          ุงููุดุทูู ({{ getActiveCount() }})
        </button>
        <button class="filter-chip" 
                [class.active]="selectedStatus === 'pending'"
                (click)="selectedStatus = 'pending'; onStatusChange()">
          <i class="fas fa-clock"></i>
          ูู ุงูุงูุชุธุงุฑ ({{ getPendingCount() }})
        </button>
      </div>
    </div>

    <div class="advanced-filters" [class.expanded]="showAdvancedFilters">
      <div class="filters-grid">
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-map-marker-alt"></i>
            ุงููุญุงูุธุฉ
          </label>
          <select class="filter-select" 
                  [(ngModel)]="selectedGovernorate" 
                  (change)="onGovernorateChange()">
            <option value="">ุฌููุน ุงููุญุงูุธุงุช</option>
            <option *ngFor="let gov of governorates" [value]="gov.id">
              {{ gov.name }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-city"></i>
            ุงููุฏููุฉ
          </label>
          <select class="filter-select" 
                  [(ngModel)]="selectedCity" 
                  (change)="onCityChange()"
                  [disabled]="!selectedGovernorate">
            <option value="">ุฌููุน ุงููุฏู</option>
            <option *ngFor="let city of cities" [value]="city.id">
              {{ city.nameAr }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-sort"></i>
            ุชุฑุชูุจ ุญุณุจ
          </label>
          <select class="filter-select" 
                  [(ngModel)]="sortBy" 
                  (change)="applyFilters()">
            <option value="date">ุงูุชุงุฑูุฎ</option>
            <option value="name">ุงูุงุณู</option>
            <option value="rating">ุงูุชูููู</option>
            <option value="orders">ุนุฏุฏ ุงูุทูุจุงุช</option>
          </select>
        </div>

        <div class="filter-actions">
          <button class="btn-filter clear" (click)="clearFilters()">
            <i class="fas fa-times"></i>
            ูุณุญ ุงูููุงุชุฑ
          </button>
          <button class="btn-filter toggle" (click)="showAdvancedFilters = !showAdvancedFilters">
            <i class="fas" [class.fa-chevron-up]="showAdvancedFilters" [class.fa-chevron-down]="!showAdvancedFilters"></i>
            {{ showAdvancedFilters ? 'ุฅุฎูุงุก' : 'ุฅุธูุงุฑ' }} ุงููุชูุฏู
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ๐ ุนุฑุถ ุงููุชุงุฆุฌ ูุฃุฏูุงุช ุงูุชุญูู -->
  <div class="results-panel">
    <div class="results-header">
      <div class="results-info">
        <div class="results-count">
          <span class="count-number">{{ filteredMerchants.length }}</span>
          <span class="count-text">ุชุงุฌุฑ</span>
          <span class="count-total" *ngIf="filteredMerchants.length !== merchants.length">
            ูู ุฃุตู {{ merchants.length }}
          </span>
        </div>
        <div class="results-pagination-info">
          ุตูุญุฉ {{ currentPage }} ูู {{ totalPages }}
        </div>
      </div>

      <div class="view-controls">
        <div class="view-mode-toggle">
          <button class="view-btn" 
                  [class.active]="viewMode === 'list'"
                  (click)="viewMode = 'list'"
                  title="ุนุฑุถ ูุงุฆูุฉ">
            <i class="fas fa-list"></i>
          </button>
          <button class="view-btn" 
                  [class.active]="viewMode === 'grid'"
                  (click)="viewMode = 'grid'"
                  title="ุนุฑุถ ุดุจูู">
            <i class="fas fa-th"></i>
          </button>
        </div>

        <div class="sort-controls">
          <button class="sort-btn" (click)="changeSortBy(sortBy)">
            <i class="fas fa-sort-amount-down" *ngIf="sortDirection === 'desc'"></i>
            <i class="fas fa-sort-amount-up" *ngIf="sortDirection === 'asc'"></i>
          </button>
        </div>

        <div class="items-per-page">
          <select [(ngModel)]="itemsPerPage" (change)="updatePagination()">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- ๐ ุญุงูุฉ ุงูุชุญููู -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-card-modern">
      <div class="loading-animation">
        <div class="spinner-modern"></div>
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      <h3 class="loading-title">ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุชุฌุงุฑ</h3>
      <p class="loading-description">ูุฑุฌู ุงูุงูุชุธุงุฑ ุฃุซูุงุก ุชุญููู ุงูุจูุงูุงุช...</p>
    </div>
  </div>

  <!-- ๐ ุนุฑุถ ุงูุชุฌุงุฑ - ูุงุฆูุฉ -->
  <div class="merchants-content" *ngIf="!isLoading && filteredMerchants.length > 0">
    
    <!-- ุนุฑุถ ุงููุงุฆูุฉ -->
    <div class="merchants-list-view" *ngIf="viewMode === 'list'">
      <div class="list-container">
        <div class="list-header">
          <div class="header-row">
            <div class="col merchant-col">ุงูุชุงุฌุฑ</div>
            <div class="col contact-col">ูุนูููุงุช ุงูุชูุงุตู</div>
            <div class="col location-col">ุงููููุน</div>
            <div class="col rating-col">ุงูุชูููู</div>
            <div class="col status-col">ุงูุญุงูุฉ</div>
            <div class="col actions-col">ุงูุฅุฌุฑุงุกุงุช</div>
          </div>
        </div>

        <div class="list-body">
          <div class="merchant-row" 
               *ngFor="let merchant of getPaginatedMerchants(); trackBy: trackByMerchantId">
            
            <!-- ูุนูููุงุช ุงูุชุงุฌุฑ -->
            <div class="col merchant-col">
              <div class="merchant-info">
                <div class="merchant-avatar">
                  <img [src]="merchant.logo || '/assets/images/default-store.png'" 
                       [alt]="merchant.shopName"
                       (error)="onImageError($event)">
                </div>
                <div class="merchant-details">
                  <h4 class="merchant-name">{{ merchant.shopName }}</h4>
                  <span class="merchant-id">#{{ merchant.id }}</span>
                  <p class="merchant-description">{{ merchant.shortDescription }}</p>
                </div>
              </div>
            </div>

            <!-- ูุนูููุงุช ุงูุชูุงุตู -->
            <div class="col contact-col">
              <div class="contact-info">
                <div class="contact-item">
                  <i class="fas fa-envelope"></i>
                  <span>{{ merchant.email }}</span>
                </div>
                <div class="contact-item">
                  <i class="fas fa-phone"></i>
                  <span>{{ merchant.mobileNo }}</span>
                </div>
              </div>
            </div>

            <!-- ุงููููุน -->
            <div class="col location-col">
              <div class="location-info">
                <div class="location-item">
                  <i class="fas fa-map-marker-alt"></i>
                  <span>{{ getGovernorateName(merchant.governorateId || 0) }}</span>
                </div>
                <div class="location-item" *ngIf="merchant.cityId">
                  <i class="fas fa-city"></i>
                  <span>{{ getCityName(merchant.cityId) }}</span>
                </div>
              </div>
            </div>

            <!-- ุงูุชูููู -->
            <div class="col rating-col">
              <div class="rating-display">
                <div class="stars">
                  <i class="fas fa-star" 
                     *ngFor="let star of [1,2,3,4,5]"
                     [class.filled]="star <= (merchant.rating || 0)"></i>
                </div>
                <div class="rating-text">
                  <span class="rating-value">{{ (merchant.rating || 0).toFixed(1) }}</span>
                  <span class="rating-count">({{ merchant.ratingCount || 0 }})</span>
                </div>
              </div>
            </div>

            <!-- ุงูุญุงูุฉ -->
            <div class="col status-col">
              <span class="status-badge" [ngClass]="getMerchantStatusClass(merchant)">
                <i class="fas fa-circle"></i>
                {{ getMerchantStatusLabel(merchant) }}
              </span>
            </div>

            <!-- ุงูุฅุฌุฑุงุกุงุช -->
            <div class="col actions-col">
              <div class="action-buttons">
                <button class="action-btn view" 
                        (click)="viewMerchant(merchant)"
                        title="ุนุฑุถ ุงูุชูุงุตูู">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="action-btn edit" 
                        (click)="editMerchant(merchant)"
                        title="ุชุนุฏูู">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn toggle" 
                        [class.activate]="getMerchantStatus(merchant) !== 'active'"
                        [class.deactivate]="getMerchantStatus(merchant) === 'active'"
                        (click)="toggleMerchantStatus(merchant)"
                        [title]="getMerchantStatus(merchant) === 'active' ? 'ุฅูุบุงุก ุงูุชูุนูู' : 'ุชูุนูู'">
                  <i class="fas fa-power-off"></i>
                </button>
                <button class="action-btn delete" 
                        (click)="deleteMerchant(merchant)"
                        title="ุญุฐู">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ุนุฑุถ ุงูุดุจูุฉ -->
    <div class="merchants-grid-view" *ngIf="viewMode === 'grid'">
      <div class="grid-container">
        <div class="merchant-card" 
             *ngFor="let merchant of getPaginatedMerchants(); trackBy: trackByMerchantId">
          
          <!-- Header ุงูุจุทุงูุฉ -->
          <div class="card-header">
            <div class="card-image">
              <img [src]="merchant.logo || '/assets/images/default-store.png'" 
                   [alt]="merchant.shopName"
                   (error)="onImageError($event)">
              <div class="image-overlay">
                <div class="status-indicator" [ngClass]="getMerchantStatusClass(merchant)">
                  <i class="fas fa-circle"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- ูุญุชูู ุงูุจุทุงูุฉ -->
          <div class="card-body">
            <div class="card-title">
              <h3 class="merchant-name">{{ merchant.shopName }}</h3>
              <span class="merchant-id">#{{ merchant.id }}</span>
            </div>
            
            <div class="card-info">
              <div class="info-item">
                <i class="fas fa-envelope"></i>
                <span>{{ merchant.email }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-phone"></i>
                <span>{{ merchant.mobileNo }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ getGovernorateName(merchant.governorateId || 0) }}</span>
              </div>
            </div>

            <div class="card-rating">
              <div class="stars">
                <i class="fas fa-star" 
                   *ngFor="let star of [1,2,3,4,5]"
                   [class.filled]="star <= (merchant.rating || 0)"></i>
              </div>
              <span class="rating-text">
                {{ (merchant.rating || 0).toFixed(1) }} ({{ merchant.ratingCount || 0 }})
              </span>
            </div>
          </div>

          <!-- ุชุฐููู ุงูุจุทุงูุฉ -->
          <div class="card-footer">
            <div class="status-display">
              <span class="status-badge" [ngClass]="getMerchantStatusClass(merchant)">
                {{ getMerchantStatusLabel(merchant) }}
              </span>
            </div>
            
            <div class="card-actions">
              <button class="card-btn primary" 
                      (click)="viewMerchant(merchant)"
                      title="ุนุฑุถ">
                <i class="fas fa-eye"></i>
              </button>
              <button class="card-btn secondary" 
                      (click)="editMerchant(merchant)"
                      title="ุชุนุฏูู">
                <i class="fas fa-edit"></i>
              </button>
              <button class="card-btn" 
                      [class.success]="getMerchantStatus(merchant) !== 'active'"
                      [class.warning]="getMerchantStatus(merchant) === 'active'"
                      (click)="toggleMerchantStatus(merchant)"
                      [title]="getMerchantStatus(merchant) === 'active' ? 'ุฅูุบุงุก ุงูุชูุนูู' : 'ุชูุนูู'">
                <i class="fas fa-power-off"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ๐ ุงูุชููู ุจูู ุงูุตูุญุงุช -->
    <div class="pagination-modern" *ngIf="totalPages > 1">
      <div class="pagination-info">
        <span class="page-info">
          ุนุฑุถ {{ (currentPage - 1) * itemsPerPage + 1 }} - 
          {{ Math.min(currentPage * itemsPerPage, filteredMerchants.length) }} 
          ูู {{ filteredMerchants.length }} ุชุงุฌุฑ
        </span>
      </div>

      <div class="pagination-controls">
        <button class="page-btn prev" 
                (click)="previousPage()" 
                [disabled]="currentPage === 1">
          <i class="fas fa-chevron-right"></i>
          ุงูุณุงุจู
        </button>

        <div class="page-numbers">
          <button class="page-number" 
                  *ngFor="let page of getVisiblePages()"
                  [class.active]="page === currentPage"
                  [class.dots]="page === -1"
                  (click)="page !== -1 && goToPage(page)"
                  [disabled]="page === -1">
            {{ page === -1 ? '...' : page }}
          </button>
        </div>

        <button class="page-btn next" 
                (click)="nextPage()" 
                [disabled]="currentPage === totalPages">
          ุงูุชุงูู
          <i class="fas fa-chevron-left"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- ๐ ุญุงูุฉ ุนุฏู ูุฌูุฏ ูุชุงุฆุฌ -->
  <div class="no-results-state" *ngIf="!isLoading && filteredMerchants.length === 0">
    <div class="no-results-card">
      <div class="no-results-icon">
        <i class="fas fa-search"></i>
      </div>
      <h3 class="no-results-title">ูุง ุชูุฌุฏ ูุชุงุฆุฌ</h3>
      <p class="no-results-description">
        ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ุชุฌุงุฑ ูุทุงุจููู ูุนุงููุฑ ุงูุจุญุซ ุงููุญุฏุฏุฉ
      </p>
      <div class="no-results-actions">
        <button class="btn-modern primary" (click)="clearFilters()">
          <i class="fas fa-undo"></i>
          ูุณุญ ุงูููุงุชุฑ
        </button>
        <button class="btn-modern secondary" (click)="addNewMerchant()">
          <i class="fas fa-plus"></i>
          ุฅุถุงูุฉ ุชุงุฌุฑ ุฌุฏูุฏ
        </button>
      </div>
    </div>
  </div>

</div>
